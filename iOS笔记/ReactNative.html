<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React Native | 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.9de76d75.js" as="script"><link rel="preload" href="/assets/js/2.98ea7a63.js" as="script"><link rel="preload" href="/assets/js/55.c3984ff9.js" as="script"><link rel="prefetch" href="/assets/js/10.fa8eed47.js"><link rel="prefetch" href="/assets/js/11.f98f25e0.js"><link rel="prefetch" href="/assets/js/12.1ab9b5a3.js"><link rel="prefetch" href="/assets/js/13.75251b00.js"><link rel="prefetch" href="/assets/js/14.b5068189.js"><link rel="prefetch" href="/assets/js/15.33abd7e1.js"><link rel="prefetch" href="/assets/js/16.34ed8053.js"><link rel="prefetch" href="/assets/js/17.b3d52ea3.js"><link rel="prefetch" href="/assets/js/18.cbe71205.js"><link rel="prefetch" href="/assets/js/19.c632cb86.js"><link rel="prefetch" href="/assets/js/20.90d9a221.js"><link rel="prefetch" href="/assets/js/21.15cb7700.js"><link rel="prefetch" href="/assets/js/22.62ea968a.js"><link rel="prefetch" href="/assets/js/23.b743fdd5.js"><link rel="prefetch" href="/assets/js/24.5d157647.js"><link rel="prefetch" href="/assets/js/25.1935fba3.js"><link rel="prefetch" href="/assets/js/26.fd22f8ee.js"><link rel="prefetch" href="/assets/js/27.f47adfe7.js"><link rel="prefetch" href="/assets/js/28.d9f5719d.js"><link rel="prefetch" href="/assets/js/29.82cbf665.js"><link rel="prefetch" href="/assets/js/3.b96f613e.js"><link rel="prefetch" href="/assets/js/30.9f901f01.js"><link rel="prefetch" href="/assets/js/31.d9e2f61c.js"><link rel="prefetch" href="/assets/js/32.b14052e9.js"><link rel="prefetch" href="/assets/js/33.1b2e5efd.js"><link rel="prefetch" href="/assets/js/34.4bf7f44f.js"><link rel="prefetch" href="/assets/js/35.98d5fd2b.js"><link rel="prefetch" href="/assets/js/36.cdaf1c2f.js"><link rel="prefetch" href="/assets/js/37.a67bdb9a.js"><link rel="prefetch" href="/assets/js/38.5d856b83.js"><link rel="prefetch" href="/assets/js/39.27169c95.js"><link rel="prefetch" href="/assets/js/4.268c621c.js"><link rel="prefetch" href="/assets/js/40.8763c647.js"><link rel="prefetch" href="/assets/js/41.cd839f43.js"><link rel="prefetch" href="/assets/js/42.a97bf97a.js"><link rel="prefetch" href="/assets/js/43.fd126bb1.js"><link rel="prefetch" href="/assets/js/44.50e2b10d.js"><link rel="prefetch" href="/assets/js/45.0c29263b.js"><link rel="prefetch" href="/assets/js/46.fdee27aa.js"><link rel="prefetch" href="/assets/js/47.c7c7e966.js"><link rel="prefetch" href="/assets/js/48.80bc6f0a.js"><link rel="prefetch" href="/assets/js/49.d457b0ac.js"><link rel="prefetch" href="/assets/js/5.f577ebb9.js"><link rel="prefetch" href="/assets/js/50.cea3b0e6.js"><link rel="prefetch" href="/assets/js/51.eaab3e31.js"><link rel="prefetch" href="/assets/js/52.010a2dfb.js"><link rel="prefetch" href="/assets/js/53.3622f7b6.js"><link rel="prefetch" href="/assets/js/54.817aba2b.js"><link rel="prefetch" href="/assets/js/56.6f20785e.js"><link rel="prefetch" href="/assets/js/57.07c7f6fc.js"><link rel="prefetch" href="/assets/js/58.4ec50d24.js"><link rel="prefetch" href="/assets/js/59.626b42b0.js"><link rel="prefetch" href="/assets/js/6.b9249342.js"><link rel="prefetch" href="/assets/js/60.ba2af5c7.js"><link rel="prefetch" href="/assets/js/61.6e22c298.js"><link rel="prefetch" href="/assets/js/62.df85ea27.js"><link rel="prefetch" href="/assets/js/63.cd3c1f6a.js"><link rel="prefetch" href="/assets/js/64.d0f75a86.js"><link rel="prefetch" href="/assets/js/65.12e0c392.js"><link rel="prefetch" href="/assets/js/66.aac422ac.js"><link rel="prefetch" href="/assets/js/67.3ff890c6.js"><link rel="prefetch" href="/assets/js/68.c6d12518.js"><link rel="prefetch" href="/assets/js/69.455e0c09.js"><link rel="prefetch" href="/assets/js/7.375eddd0.js"><link rel="prefetch" href="/assets/js/70.73d975e7.js"><link rel="prefetch" href="/assets/js/71.66528e07.js"><link rel="prefetch" href="/assets/js/72.a608a326.js"><link rel="prefetch" href="/assets/js/73.b8ed0811.js"><link rel="prefetch" href="/assets/js/74.68f4db5d.js"><link rel="prefetch" href="/assets/js/75.85059bdc.js"><link rel="prefetch" href="/assets/js/8.a04b9d9b.js"><link rel="prefetch" href="/assets/js/9.04a00c43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iOS笔记/工具.html" class="sidebar-link">工具</a></li><li><a href="/iOS笔记/计算机网络.html" class="sidebar-link">计算机网络</a></li><li><a href="/iOS笔记/架构.html" class="sidebar-link">架构</a></li><li><a href="/iOS笔记/视频播放器设计（基于FFmpeg）.html" class="sidebar-link">视频播放器设计（基于FFmpeg）</a></li><li><a href="/iOS笔记/视频常识.html" class="sidebar-link">视频常识</a></li><li><a href="/iOS笔记/数据结构与算法分析.html" class="sidebar-link">数据结构与算法分析</a></li><li><a href="/iOS笔记/算法.html" class="sidebar-link">算法</a></li><li><a href="/iOS笔记/音频常识.html" class="sidebar-link">音频常识</a></li><li><a href="/iOS笔记/音视频开发.html" class="sidebar-link">音视频开发</a></li><li><a href="/iOS笔记/直播.html" class="sidebar-link">直播</a></li><li><a href="/iOS笔记/App启动优化.html" class="sidebar-link">App启动优化</a></li><li><a href="/iOS笔记/Audio.html" class="sidebar-link">Audio</a></li><li><a href="/iOS笔记/AudioToolbox.html" class="sidebar-link">AudioToolbox</a></li><li><a href="/iOS笔记/AVFoundation.html" class="sidebar-link">AVFoundation</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C#</a></li><li><a href="/iOS笔记/C++.html" class="sidebar-link">C++</a></li><li><a href="/iOS笔记/CoreAudio.html" class="sidebar-link">CoreAudio</a></li><li><a href="/iOS笔记/CoreVideo.html" class="sidebar-link">CoreVideo</a></li><li><a href="/iOS笔记/FFmpeg.html" class="sidebar-link">FFmpeg</a></li><li><a href="/iOS笔记/Flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/iOS笔记/GPUImage.html" class="sidebar-link">GPUImage</a></li><li><a href="/iOS笔记/ijkPlayer.html" class="sidebar-link">ijkPlayer</a></li><li><a href="/iOS笔记/iOS细节.html" class="sidebar-link">iOS细节</a></li><li><a href="/iOS笔记/iOS性能优化.html" class="sidebar-link">iOS性能优化</a></li><li><a href="/iOS笔记/LFLiveKit.html" class="sidebar-link">LFLiveKit</a></li><li><a href="/iOS笔记/Metal.html" class="sidebar-link">Metal</a></li><li><a href="/iOS笔记/Objective-C.html" class="sidebar-link">Objective-C</a></li><li><a href="/iOS笔记/OpenGL相关概念.html" class="sidebar-link">OpenGL相关概念</a></li><li><a href="/iOS笔记/pthread.html" class="sidebar-link">pthread</a></li><li><a href="/iOS笔记/ReactNative.html" class="active sidebar-link">React Native</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#javascriptcore引擎" class="sidebar-link">JavaScriptCore引擎</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#rn与oc通信" class="sidebar-link">RN与OC通信</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#加载js源码流程" class="sidebar-link">加载JS源码流程</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#ui控件渲染流程" class="sidebar-link">UI控件渲染流程</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#事件处理流程" class="sidebar-link">事件处理流程</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#rctrootview" class="sidebar-link">RCTRootView</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#rctbridge" class="sidebar-link">RCTBridge</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ReactNative.html#启动流程" class="sidebar-link">启动流程</a></li></ul></li><li><a href="/iOS笔记/RunLoop.html" class="sidebar-link">RunLoop</a></li><li><a href="/iOS笔记/UI视图.html" class="sidebar-link">UI视图</a></li><li><a href="/iOS笔记/VideoToolbox.html" class="sidebar-link">VideoToolbox</a></li><li><a href="/iOS笔记/WebAssembly.html" class="sidebar-link">WebAssembly</a></li><li><a href="/iOS笔记/WebRTC.html" class="sidebar-link">WebRTC</a></li><li><a href="/iOS笔记/第三方.html" class="sidebar-link">第三方</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-native"><a href="#react-native" class="header-anchor">#</a> React Native</h1> <h2 id="javascriptcore引擎"><a href="#javascriptcore引擎" class="header-anchor">#</a> JavaScriptCore引擎</h2> <h2 id="rn与oc通信"><a href="#rn与oc通信" class="header-anchor">#</a> RN与OC通信</h2> <h3 id="两端都保存objective-c暴露给js的配置表-存有模块和方法-实际通过moduleid、methodid和arguments来通信"><a href="#两端都保存objective-c暴露给js的配置表-存有模块和方法-实际通过moduleid、methodid和arguments来通信" class="header-anchor">#</a> 两端都保存Objective-C暴露给JS的配置表，存有模块和方法，实际通过ModuleId、MethodId和Arguments来通信</h3> <h3 id="通过runtime获取所有的类-判断是否实现了rctbridgemodule接口-就可以取得所有模块类"><a href="#通过runtime获取所有的类-判断是否实现了rctbridgemodule接口-就可以取得所有模块类" class="header-anchor">#</a> 通过runtime获取所有的类，判断是否实现了RCTBridgeModule接口，就可以取得所有模块类</h3> <h3 id="子主题-3"><a href="#子主题-3" class="header-anchor">#</a> 子主题 3</h3> <h2 id="加载js源码流程"><a href="#加载js源码流程" class="header-anchor">#</a> 加载JS源码流程</h2> <h3 id="rctjavascriptloader-loadbundleaturl-加载远程服务器中的js代码"><a href="#rctjavascriptloader-loadbundleaturl-加载远程服务器中的js代码" class="header-anchor">#</a> [RCTJavaScriptLoader loadBundleAtURL]加载远程服务器中的JS代码</h3> <ul><li><p>attemptAsynchronousLoadOfBundleAtURL开启异步加载JS代码</p> <ul><li><p>RCTCxxBridge执行executeSourceCode方法，执行源代码</p> <ul><li><p>执行完后发送通知RCTJavaScriptDidLoadNotification</p> <ul><li><p>收到通知后创建RCTRootContentView</p> <ul><li>RCTRootView runApplication通知JS运行App</li></ul></li></ul></li></ul></li></ul></li></ul> <h2 id="ui控件渲染流程"><a href="#ui控件渲染流程" class="header-anchor">#</a> UI控件渲染流程</h2> <h3 id="rctrootview-runapplication通知js运行app"><a href="#rctrootview-runapplication通知js运行app" class="header-anchor">#</a> RCTRootView runApplication通知JS运行App</h3> <ul><li><p>调用bridge一系列方法</p> <ul><li><p>创建View</p> <ul><li>添加子控件，完成UI渲染</li></ul></li></ul></li></ul> <h2 id="事件处理流程"><a href="#事件处理流程" class="header-anchor">#</a> 事件处理流程</h2> <h3 id="创建rctrootcontentview时-内部会创建rcttouchhandler"><a href="#创建rctrootcontentview时-内部会创建rcttouchhandler" class="header-anchor">#</a> 创建RCTRootContentView时，内部会创建RCTTouchHandler</h3> <ul><li><p>RCTTouchHandler内部会创建RCTEventDispatcher</p> <ul><li>通过RCTEventDispatcher将事件分发出去，最终调用RCTCxxBridge的enqueueJSCall方法进行JS调用</li></ul></li></ul> <h2 id="rctrootview"><a href="#rctrootview" class="header-anchor">#</a> RCTRootView</h2> <h3 id="注册监听bridgedidreload-javascriptdidload-hideloadingview"><a href="#注册监听bridgedidreload-javascriptdidload-hideloadingview" class="header-anchor">#</a> 注册监听bridgeDidReload，javaScriptDidLoad，hideLoadingView</h3> <ul><li>监听到bridgeDidReload时设置reactTag为nil</li> <li>监听到javaScriptDidLoad时，重新创建RCTRootContentView</li></ul> <h3 id="rctrootcontentview"><a href="#rctrootcontentview" class="header-anchor">#</a> RCTRootContentView</h3> <ul><li><p>RCTCxxBridge</p> <ul><li><p>RCTUIManager</p> <ul><li><p>注册RCTRootContentView，存储到字典viewRegistry</p></li> <li><p>注册RCTRootShadowView，存储到字典shadowViewRegistry</p> <ul><li>RCTShadowView保存对应UIView的布局和子控件，管理UIView的加载，每创建一个UIView，就会创建一个RCTShadowView，与UIView一一对应</li></ul></li> <li><p>封装了刷新UI，修改UI的一些管理方法</p></li></ul></li></ul></li> <li><p>RCTTouchHandler</p> <ul><li>RCTEventDispatcher</li></ul></li></ul> <h3 id="调用runapplication方法"><a href="#调用runapplication方法" class="header-anchor">#</a> 调用runApplication方法</h3> <ul><li>调用RCTCxxBridge的enqueueJSCall方法</li></ul> <h2 id="rctbridge"><a href="#rctbridge" class="header-anchor">#</a> RCTBridge</h2> <h3 id="rctperformancelogger"><a href="#rctperformancelogger" class="header-anchor">#</a> RCTPerformanceLogger</h3> <h3 id="调用setup方法创建cxxbridge"><a href="#调用setup方法创建cxxbridge" class="header-anchor">#</a> 调用setup方法创建cxxbridge</h3> <ul><li><p>RCTCxxBridge</p> <ul><li><p>当接收到触摸事件后调用enqueueJSCall方法，执行instance-&gt;callJSFunction方法</p> <ul><li><p>在instance中调用nativeToJsBridge-&gt;callFunction方法</p> <ul><li><p>在NativeToJsBridge中调用JSIExecutor的callFunction方法</p> <ul><li><p>在JSIExecutor中调用NativeToJsBridge的callNativeModules方法</p> <ul><li><p>在NativeToJsBridge中遍历调用RegistryModule的callNativeMethod。</p> <ul><li><p>在ModuleRegistry中调用RCTNativeModule的invoke方法</p> <ul><li><p>在RCTNativeModule中调用invokeInner方法</p> <ul><li>在RCTNativeModule中调用RCTModuleMethod的invokeWithBridge方法，执行原生调用</li></ul></li></ul></li></ul></li> <li><p>同时批量处理完成后调用RCTCxxBridge中onBatchComplete的方法，在onBatchComplete方法中循环为moduleData的RCTUIManager调用batchDidComplete方法来加载子控件</p> <ul><li>通过JS调用RCTUIManager中的createView来创建子控件</li></ul></li></ul></li></ul></li></ul></li></ul></li> <li><p>RCTReloadCommand刷新监听</p></li> <li><p>_reactInstance</p> <ul><li>callJSFunction</li></ul></li> <li><p>启动过程：调用start方法</p> <ul><li><p>创建jsThread常驻线程用来执行JS代码</p></li> <li><p>将js需要用到的OC类封装成RCTModuleData，存储在一个字典和数组里</p> <ul><li><p>是如何将OC类暴露给JS的呢？</p> <ul><li>1.遵守RCTBridgeModule协议</li> <li>2.在implemention中调用RCT_EXPORT_MODULE()实现协议方法</li> <li>3.调用RCTBridge中的RCTRegisterModule，将该类加入到全局唯一的数组中</li> <li>4.RCT_EXPORT_METHOD()暴露类对象的方法</li></ul></li></ul></li> <li><p>准备JS运行环境：初始化_reactInstance，初始化JSExecutorFactory，在js线程，创建js的RCTMessageThread，初始化nativeToJsBridge_</p> <ul><li><p>_reactInstance初始化需要一个ModuleRegistry</p> <ul><li><p>ModuleRegistry包含了所有的RCTNativeModule</p> <ul><li>每个RCTNativeModule包含了RCTModuleData</li></ul></li> <li><p>_reactInstance初始化的时候创建了NativeToJsBridge实例</p> <ul><li>NativeToJsBridge里面主要创建了JSCExecutor</li></ul></li></ul></li></ul></li> <li><p>loadSource加载JS源码</p> <ul><li><p>RCTJavaScriptLoader</p> <ul><li>封装NSURLSession下载</li></ul></li></ul></li> <li><p>以上做完后通过notify的全局队列执行JS源码，步骤如下：</p> <ul><li><p>1.执行RCTCxxBridge中的executeSourceCode方法</p></li> <li><p>2.执行enqueueApplicationScript方法，同时调用enqueueJSCall方法</p></li> <li><p>3.执行executeApplicationScript方法</p> <ul><li><p>在RCTCxxBridge中调用reactInstance的方法loadScriptFromString</p> <ul><li><p>在Instance中调用NativeToJsBridge的loadApplication方法</p> <ul><li>在NativeToJsBridge中调用JSIExecutor的loadApplicationScript方法</li></ul></li></ul></li></ul></li></ul></li></ul></li> <li><p>RCTMessageThread用于在js线程中执行c++的同步和异步函数</p></li></ul></li></ul> <h2 id="启动流程"><a href="#启动流程" class="header-anchor">#</a> 启动流程</h2> <h3 id="创建rctrootview"><a href="#创建rctrootview" class="header-anchor">#</a> 创建RCTRootView</h3> <ul><li><p>创建RCTBridge</p> <p>桥接对象，管理JS和OC交互，中转作用</p> <ul><li><p>创建RCTCxxBridge</p> <p>批量桥架对象，JS和OC交互具体实现都在这个类中</p> <ul><li><p>创建OC模块表</p> <ul><li><p>加载JS源码</p> <ul><li><p>执行JS源码，回调OC，调用OC中的组件</p> <ul><li>完成UI渲染</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul> <p><em>XMind - Trial Version</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/iOS笔记/pthread.html" class="prev">
        pthread
      </a></span> <span class="next"><a href="/iOS笔记/RunLoop.html">
        RunLoop
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9de76d75.js" defer></script><script src="/assets/js/2.98ea7a63.js" defer></script><script src="/assets/js/55.c3984ff9.js" defer></script>
  </body>
</html>
