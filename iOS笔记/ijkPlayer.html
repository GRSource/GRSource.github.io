<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ijkPlayer | 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.9de76d75.js" as="script"><link rel="preload" href="/assets/js/2.98ea7a63.js" as="script"><link rel="preload" href="/assets/js/63.cd3c1f6a.js" as="script"><link rel="prefetch" href="/assets/js/10.fa8eed47.js"><link rel="prefetch" href="/assets/js/11.f98f25e0.js"><link rel="prefetch" href="/assets/js/12.1ab9b5a3.js"><link rel="prefetch" href="/assets/js/13.75251b00.js"><link rel="prefetch" href="/assets/js/14.b5068189.js"><link rel="prefetch" href="/assets/js/15.33abd7e1.js"><link rel="prefetch" href="/assets/js/16.34ed8053.js"><link rel="prefetch" href="/assets/js/17.b3d52ea3.js"><link rel="prefetch" href="/assets/js/18.cbe71205.js"><link rel="prefetch" href="/assets/js/19.c632cb86.js"><link rel="prefetch" href="/assets/js/20.90d9a221.js"><link rel="prefetch" href="/assets/js/21.15cb7700.js"><link rel="prefetch" href="/assets/js/22.62ea968a.js"><link rel="prefetch" href="/assets/js/23.b743fdd5.js"><link rel="prefetch" href="/assets/js/24.5d157647.js"><link rel="prefetch" href="/assets/js/25.1935fba3.js"><link rel="prefetch" href="/assets/js/26.fd22f8ee.js"><link rel="prefetch" href="/assets/js/27.f47adfe7.js"><link rel="prefetch" href="/assets/js/28.d9f5719d.js"><link rel="prefetch" href="/assets/js/29.82cbf665.js"><link rel="prefetch" href="/assets/js/3.b96f613e.js"><link rel="prefetch" href="/assets/js/30.9f901f01.js"><link rel="prefetch" href="/assets/js/31.d9e2f61c.js"><link rel="prefetch" href="/assets/js/32.b14052e9.js"><link rel="prefetch" href="/assets/js/33.1b2e5efd.js"><link rel="prefetch" href="/assets/js/34.4bf7f44f.js"><link rel="prefetch" href="/assets/js/35.98d5fd2b.js"><link rel="prefetch" href="/assets/js/36.cdaf1c2f.js"><link rel="prefetch" href="/assets/js/37.a67bdb9a.js"><link rel="prefetch" href="/assets/js/38.5d856b83.js"><link rel="prefetch" href="/assets/js/39.27169c95.js"><link rel="prefetch" href="/assets/js/4.268c621c.js"><link rel="prefetch" href="/assets/js/40.8763c647.js"><link rel="prefetch" href="/assets/js/41.cd839f43.js"><link rel="prefetch" href="/assets/js/42.a97bf97a.js"><link rel="prefetch" href="/assets/js/43.fd126bb1.js"><link rel="prefetch" href="/assets/js/44.50e2b10d.js"><link rel="prefetch" href="/assets/js/45.0c29263b.js"><link rel="prefetch" href="/assets/js/46.fdee27aa.js"><link rel="prefetch" href="/assets/js/47.c7c7e966.js"><link rel="prefetch" href="/assets/js/48.80bc6f0a.js"><link rel="prefetch" href="/assets/js/49.d457b0ac.js"><link rel="prefetch" href="/assets/js/5.f577ebb9.js"><link rel="prefetch" href="/assets/js/50.cea3b0e6.js"><link rel="prefetch" href="/assets/js/51.eaab3e31.js"><link rel="prefetch" href="/assets/js/52.010a2dfb.js"><link rel="prefetch" href="/assets/js/53.3622f7b6.js"><link rel="prefetch" href="/assets/js/54.817aba2b.js"><link rel="prefetch" href="/assets/js/55.c3984ff9.js"><link rel="prefetch" href="/assets/js/56.6f20785e.js"><link rel="prefetch" href="/assets/js/57.07c7f6fc.js"><link rel="prefetch" href="/assets/js/58.4ec50d24.js"><link rel="prefetch" href="/assets/js/59.626b42b0.js"><link rel="prefetch" href="/assets/js/6.b9249342.js"><link rel="prefetch" href="/assets/js/60.ba2af5c7.js"><link rel="prefetch" href="/assets/js/61.6e22c298.js"><link rel="prefetch" href="/assets/js/62.df85ea27.js"><link rel="prefetch" href="/assets/js/64.d0f75a86.js"><link rel="prefetch" href="/assets/js/65.12e0c392.js"><link rel="prefetch" href="/assets/js/66.aac422ac.js"><link rel="prefetch" href="/assets/js/67.3ff890c6.js"><link rel="prefetch" href="/assets/js/68.c6d12518.js"><link rel="prefetch" href="/assets/js/69.455e0c09.js"><link rel="prefetch" href="/assets/js/7.375eddd0.js"><link rel="prefetch" href="/assets/js/70.73d975e7.js"><link rel="prefetch" href="/assets/js/71.66528e07.js"><link rel="prefetch" href="/assets/js/72.a608a326.js"><link rel="prefetch" href="/assets/js/73.b8ed0811.js"><link rel="prefetch" href="/assets/js/74.68f4db5d.js"><link rel="prefetch" href="/assets/js/75.85059bdc.js"><link rel="prefetch" href="/assets/js/8.a04b9d9b.js"><link rel="prefetch" href="/assets/js/9.04a00c43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iOS笔记/工具.html" class="sidebar-link">工具</a></li><li><a href="/iOS笔记/计算机网络.html" class="sidebar-link">计算机网络</a></li><li><a href="/iOS笔记/架构.html" class="sidebar-link">架构</a></li><li><a href="/iOS笔记/视频播放器设计（基于FFmpeg）.html" class="sidebar-link">视频播放器设计（基于FFmpeg）</a></li><li><a href="/iOS笔记/视频常识.html" class="sidebar-link">视频常识</a></li><li><a href="/iOS笔记/数据结构与算法分析.html" class="sidebar-link">数据结构与算法分析</a></li><li><a href="/iOS笔记/算法.html" class="sidebar-link">算法</a></li><li><a href="/iOS笔记/音频常识.html" class="sidebar-link">音频常识</a></li><li><a href="/iOS笔记/音视频开发.html" class="sidebar-link">音视频开发</a></li><li><a href="/iOS笔记/直播.html" class="sidebar-link">直播</a></li><li><a href="/iOS笔记/App启动优化.html" class="sidebar-link">App启动优化</a></li><li><a href="/iOS笔记/Audio.html" class="sidebar-link">Audio</a></li><li><a href="/iOS笔记/AudioToolbox.html" class="sidebar-link">AudioToolbox</a></li><li><a href="/iOS笔记/AVFoundation.html" class="sidebar-link">AVFoundation</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C#</a></li><li><a href="/iOS笔记/C++.html" class="sidebar-link">C++</a></li><li><a href="/iOS笔记/CoreAudio.html" class="sidebar-link">CoreAudio</a></li><li><a href="/iOS笔记/CoreVideo.html" class="sidebar-link">CoreVideo</a></li><li><a href="/iOS笔记/FFmpeg.html" class="sidebar-link">FFmpeg</a></li><li><a href="/iOS笔记/Flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/iOS笔记/GPUImage.html" class="sidebar-link">GPUImage</a></li><li><a href="/iOS笔记/ijkPlayer.html" class="active sidebar-link">ijkPlayer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#ijkavmovieplayercontroller" class="sidebar-link">IJKAVMoviePlayerController</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#ijkmpmovieplayercontroller" class="sidebar-link">IJKMPMoviePlayerController</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#ijkffmovieplayercontroller" class="sidebar-link">IJKFFMoviePlayerController</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#音视频同步" class="sidebar-link">音视频同步</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#音视频解码" class="sidebar-link">音视频解码</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#ffmpeg" class="sidebar-link">ffmpeg</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#opengl-es" class="sidebar-link">OpenGL ES</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#picture-queue" class="sidebar-link">picture queue</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#sample-queue" class="sidebar-link">sample queue</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/ijkPlayer.html#audioqueue" class="sidebar-link">AudioQueue</a></li></ul></li><li><a href="/iOS笔记/iOS细节.html" class="sidebar-link">iOS细节</a></li><li><a href="/iOS笔记/iOS性能优化.html" class="sidebar-link">iOS性能优化</a></li><li><a href="/iOS笔记/LFLiveKit.html" class="sidebar-link">LFLiveKit</a></li><li><a href="/iOS笔记/Metal.html" class="sidebar-link">Metal</a></li><li><a href="/iOS笔记/Objective-C.html" class="sidebar-link">Objective-C</a></li><li><a href="/iOS笔记/OpenGL相关概念.html" class="sidebar-link">OpenGL相关概念</a></li><li><a href="/iOS笔记/pthread.html" class="sidebar-link">pthread</a></li><li><a href="/iOS笔记/ReactNative.html" class="sidebar-link">React Native</a></li><li><a href="/iOS笔记/RunLoop.html" class="sidebar-link">RunLoop</a></li><li><a href="/iOS笔记/UI视图.html" class="sidebar-link">UI视图</a></li><li><a href="/iOS笔记/VideoToolbox.html" class="sidebar-link">VideoToolbox</a></li><li><a href="/iOS笔记/WebAssembly.html" class="sidebar-link">WebAssembly</a></li><li><a href="/iOS笔记/WebRTC.html" class="sidebar-link">WebRTC</a></li><li><a href="/iOS笔记/第三方.html" class="sidebar-link">第三方</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ijkplayer"><a href="#ijkplayer" class="header-anchor">#</a> ijkPlayer</h1> <p>https://cloud.tencent.com/developer/article/1032547</p> <h2 id="ijkavmovieplayercontroller"><a href="#ijkavmovieplayercontroller" class="header-anchor">#</a> IJKAVMoviePlayerController</h2> <h2 id="ijkmpmovieplayercontroller"><a href="#ijkmpmovieplayercontroller" class="header-anchor">#</a> IJKMPMoviePlayerController</h2> <h2 id="ijkffmovieplayercontroller"><a href="#ijkffmovieplayercontroller" class="header-anchor">#</a> IJKFFMoviePlayerController</h2> <h3 id="ijkffoptions分为五类"><a href="#ijkffoptions分为五类" class="header-anchor">#</a> IJKFFOptions分为五类</h3> <ul><li><p>kIJKFFOptionCategoryFormat</p> <ul><li><p>默认值为</p> <ul><li>auto_convert=0</li> <li>reconnect=1</li> <li>timeout=30 * 1000 * 1000</li> <li>user-agent=@&quot;ijkplayer&quot;</li></ul></li></ul></li> <li><p>kIJKFFOptionCategoryCodec</p></li> <li><p>kIJKFFOptionCategorySws</p></li> <li><p>kIJKFFOptionCategoryPlayer</p> <ul><li><p>默认值为</p> <ul><li>max-fps=30</li> <li>framedrop=0</li> <li>video-pictq-size=3</li> <li>videotoolbox=0</li> <li>videotoolbox-max-frame-width=960</li></ul></li></ul></li> <li><p>kIJKFFOptionCategorySwr</p></li></ul> <h3 id="ijkmediaplayer"><a href="#ijkmediaplayer" class="header-anchor">#</a> IjkMediaPlayer</h3> <ul><li><p>初始化流程</p> <p>简单来说，就是创建播放器对象，完成音视频解码、渲染的准备工作</p> <ul><li><p>IjkMediaPlayer对象通过ijkplayer_ios.m类中的ijkmp_ios_create方法创建，同时做了三个动作</p> <ul><li><p>ijkmp_create创建IjkMediaPlayer</p> <ul><li>mallocz创建</li> <li>通过ffp_create方法创建FFPlayer对象</li> <li>设置消息处理函数msg_loop</li></ul></li> <li><p>通过SDL_VoutIos_CreateForGLES2方法创建图像渲染对象SDL_Vout，存放到FFPlayer对象当中</p></li> <li><p>通过ffpipeline_create_from_ios方法创建平台相关的IJKFF_Pipeline对象，包括视频解码以及音频输出部分，存放到FFPlayer对象当中</p></li></ul></li></ul></li> <li><p>主要持有ffplayer和msg_loop，所以不难看出IjkMediaPlayer的核心是ffmpeg中的ffplay.c</p></li> <li><p>将IjkMediaPlayer对象传入ijkplayer.c的ijkmp_prepare_async进行播放</p> <ul><li><p>ijkplayer.c当中调用ijkmp_prepare_async_l</p> <ul><li>调用ff_ffplay.c当中的ffp_prepare_async_l。ff_ffplay.c应该是对ffmpeg中的ffplay.c的重新</li></ul></li></ul></li></ul> <h3 id="ijksdlglview"><a href="#ijksdlglview" class="header-anchor">#</a> IJKSDLGLView</h3> <h3 id="ijkaudiokit-sharedinstance-setupaudiosession"><a href="#ijkaudiokit-sharedinstance-setupaudiosession" class="header-anchor">#</a> [[IJKAudioKit sharedInstance] setupAudioSession];</h3> <h3 id="ijknotificationmanager"><a href="#ijknotificationmanager" class="header-anchor">#</a> IJKNotificationManager</h3> <h2 id="音视频同步"><a href="#音视频同步" class="header-anchor">#</a> 音视频同步</h2> <p>对于播放器来说，音视频同步是一个关键点，同时也是一个难点，同步效果的好坏，直接决定着播放器的质量。通常音视频同步的解决方案就是选择一个参考时钟，播放时读取音视频帧上的时间戳，同时参考当前时钟参考时钟上的时间来安排播放。              如果音视频帧的播放时间大于当前参考时钟上的时间，则不急于播放该帧，直到参考时钟达到该帧的时间戳；如果音视频帧的时间戳小于当前参考时钟上的时间，则需要“尽快”播放该帧或丢弃，以便播放进度追上参考时钟。</p> <h3 id="选取视频时间戳作为参考时钟源"><a href="#选取视频时间戳作为参考时钟源" class="header-anchor">#</a> 选取视频时间戳作为参考时钟源</h3> <h3 id="选取音频时间戳作为参考时钟源"><a href="#选取音频时间戳作为参考时钟源" class="header-anchor">#</a> 选取音频时间戳作为参考时钟源</h3> <h3 id="选取外部时间作为参考时钟源"><a href="#选取外部时间作为参考时钟源" class="header-anchor">#</a> 选取外部时间作为参考时钟源</h3> <h2 id="音视频解码"><a href="#音视频解码" class="header-anchor">#</a> 音视频解码</h2> <p>ijkplayer在视频解码上支持软解和硬解两种方式，可在起播前配置优先使用的解码方式，播放过程中不可切换。iOS平台上硬解使用VideoToolbox，Android平台上使用MediaCodec。ijkplayer中的音频解码只支持软解，暂不支持硬解。</p> <h3 id="subtitle-queue"><a href="#subtitle-queue" class="header-anchor">#</a> subtitle queue</h3> <h3 id="video-queue"><a href="#video-queue" class="header-anchor">#</a> video queue</h3> <ul><li><p>ffplay.c中video_thread，支持软解和硬解</p> <ul><li><p>调用ffpipenode.c中的ffpipenode_run_sync</p> <p>ffpipenode_run_sync中调用的是IJKFF_Pipenode对象中的func_run_sync</p> <ul><li><p>func_run_sync</p> <p>func_run_sync取决于播放前配置的软硬解，假设为软解，则调用</p> <ul><li><p>软解</p> <ul><li><p>调用ffplay.c中的ffp_video_thread</p> <ul><li><p>get_video_frame</p> <p>获取解码前的AVFrame</p> <ul><li><p>decoder_decode_frame</p> <p>该方法中从解码前的video queue中取出一帧数据，送入decoder进行解码，解码后的数据在ffplay_video_thread中送入pictq</p> <ul><li><p>存入pictq</p> <p>FrameQueue结构体类型</p></li></ul></li></ul></li></ul></li></ul></li> <li><p>硬解</p> <ul><li><p>调用ffpipenode_ios_videotoolbox_vdec.c中的videotoolbox_video_thread</p> <ul><li>videotoolbox_async_decode_frame</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul> <h3 id="audio-queue"><a href="#audio-queue" class="header-anchor">#</a> audio queue</h3> <ul><li><p>ffplay.c中的audio_thread，仅支持软解</p> <ul><li><p>packet_queue_get</p> <ul><li><p>avcodec_send_packet和avcodec_receive_frame</p> <ul><li>frame_queue_push</li></ul></li></ul></li></ul></li></ul> <h2 id="ffmpeg"><a href="#ffmpeg" class="header-anchor">#</a> ffmpeg</h2> <h3 id="ffplay-c代码流程"><a href="#ffplay-c代码流程" class="header-anchor">#</a> ffplay.c代码流程</h3> <ul><li><p>开始播放</p> <ul><li><p>ffp_prepare_async_1</p> <p>创建了音频输出对象</p> <ul><li><p>stream_open</p> <ul><li><p>stream_open的操作：1.创建存音视频解码前数据的videooq/audioq；2.创建存放音视频解码后数据的pictq/sampq；3.启动读数据线程read_thread；4.启动视频显示线程video_refresh_thread</p> <ul><li><p>read_thread</p> <p>数据读取的整个过程都是由ffmpeg内部完成的，接收到网络过来的数据后，ffmpeg根据其封装格式，完成了解复用的动作，我们得到的，是音视频分离开的解码前的数据</p> <ul><li><p>avformat_alloc_context</p> <p>创建上下文结构体，这个结构体是最上层的结构体，表示输入上下文</p> <ul><li><p>avformat_open_input</p> <p>打开文件，主要是探测协议类型，如果是网络文件则创建网络链接等</p> <ul><li><p>avformat_find_stream_info</p> <p>探测媒体类型，可得到当前文件的封装格式，音视频编码参数等信息</p> <ul><li><p>stream_component_open</p> <p>打开视频、音频解码器。在此会打开相应解码器，并创建相应的解码线程。同时也调用了audio_open打开了audio output设备。</p> <ul><li><p>av_read_frame</p> <p>读取媒体数据，得到的是音视频分离的解码前数据</p> <ul><li><p>packet_queue_put</p> <p>将音视频数据AVPacket分别送入相应的queue中。</p></li></ul></li></ul></li></ul></li></ul></li></ul></li> <li><p>ic-&gt;interrupt_callback.callback = decode_interrupt_cb;
ic-&gt;interrupt_callback.opaque = is;</p> <p>设置中断函数，如果出错或者退出，就可以立刻退出</p></li></ul></li></ul></li></ul></li></ul></li></ul></li> <li><p>iOS源码分析视频解码方式的选择，在stream_component_open方法中</p> <ul><li><p>打开解码器avcodec_open2</p> <ul><li><p>通过ffpipeline_open_video_decoder创建IJKFF_Pipenode，其最终调用的是ffpipeline_ios.c中的func_open_video_decoder来创建IJKFF_Pipenode的</p> <ul><li><div class="language- extra-class"><pre><code>IJKFF_Pipenode* node = NULL;
</code></pre></div></li></ul></li></ul></li></ul> <p>IJKFF_Pipeline_Opaque *opaque = pipeline-&gt;opaque;
if (ffp-&gt;videotoolbox) {
node = ffpipenode_create_video_decoder_from_ios_videotoolbox(ffp);
if (!node)
ALOGE(&quot;vtb fail!!! switch to ffmpeg decode!!!! \n&quot;);
}
if (node == NULL) {
node = ffpipenode_create_video_decoder_from_ffplay(ffp);
ffp-&gt;stat.vdec_type = FFP_PROPV_DECODER_AVCODEC;
opaque-&gt;is_videotoolbox_open = false;
} else {
ffp-&gt;stat.vdec_type = FFP_PROPV_DECODER_VIDEOTOOLBOX;
opaque-&gt;is_videotoolbox_open = true;
}
ffp_notify_msg2(ffp, FFP_MSG_VIDEO_DECODER_OPEN, opaque-&gt;is_videotoolbox_open);
return node;</p> <div class="language- extra-class"><pre><code>  		- 如果配置了ffp-&gt;videotoolbox，会优先去尝试打开硬件编码器ffpipenode_create_video_decoder_from_ios_videotoolbox，如果硬件编码器打开失败，则会自动切换至软解ffpipenode_create_video_decoder_from_ffplay

  			- ffp-&gt;videotoolbox需要在起播前通过如下方法配置：
</code></pre></div></li></ul> <p>ijkmp_set_option_int(_mediaPlayer, IJKMP_OPT_CATEGORY_PLAYER,</p> <p>&quot;videotoolbox&quot;, 1);</p> <h2 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h2> <h3 id="tools-初始化项目工程脚本"><a href="#tools-初始化项目工程脚本" class="header-anchor">#</a> tools  初始化项目工程脚本</h3> <h3 id="config-编译ffmpeg使用的配置文件"><a href="#config-编译ffmpeg使用的配置文件" class="header-anchor">#</a> config  编译ffmpeg使用的配置文件</h3> <h3 id="extra-存放编译ijkplayer所需的依赖源文件-如ffmpeg、openssl等"><a href="#extra-存放编译ijkplayer所需的依赖源文件-如ffmpeg、openssl等" class="header-anchor">#</a> extra  存放编译ijkplayer所需的依赖源文件，如ffmpeg、openssl等</h3> <h3 id="ijkmedia-核心代码"><a href="#ijkmedia-核心代码" class="header-anchor">#</a> ijkmedia  核心代码</h3> <ul><li>ijkplayer  播放器数据下载及解码相关</li> <li>ijksdl音视频数据渲染相关</li></ul> <h3 id="ios-ios平台上的上层接口封装以及平台相关方法"><a href="#ios-ios平台上的上层接口封装以及平台相关方法" class="header-anchor">#</a> ios  iOS平台上的上层接口封装以及平台相关方法</h3> <h3 id="android-android平台上的上层接口封装以及平台相关方法"><a href="#android-android平台上的上层接口封装以及平台相关方法" class="header-anchor">#</a> android  android平台上的上层接口封装以及平台相关方法</h3> <h2 id="opengl-es"><a href="#opengl-es" class="header-anchor">#</a> OpenGL ES</h2> <h2 id="picture-queue"><a href="#picture-queue" class="header-anchor">#</a> picture queue</h2> <h3 id="video-refresh-thread视频渲染"><a href="#video-refresh-thread视频渲染" class="header-anchor">#</a> video_refresh_thread视频渲染</h3> <p>iOS平台上采用OpenGL渲染解码后的YUV图像，渲染线程为video_refresh_thread，最后渲染图像的方法为video_image_display2</p> <ul><li><p>frame_queue_peek_last读取帧</p> <p>从pictq对象中读取当前需要显示的视频帧</p> <ul><li><p>SDL_VoutDisplayYUVOverlay进行绘制</p> <ul><li>实际上调用的是vout_display_overlay进行绘制，该方法就是调用OpenGL绘制图像。</li></ul></li></ul></li></ul> <h2 id="sample-queue"><a href="#sample-queue" class="header-anchor">#</a> sample queue</h2> <h3 id="sdl-audio-callback音频输出"><a href="#sdl-audio-callback音频输出" class="header-anchor">#</a> sdl_audio_callback音频输出</h3> <p>在stream_component_open中调用了audio_open打开了audio output设备，audio_open中配置了音频输出的相关参数SDL_AudioSpec，并通过SDL_AoutOpenAudio设置给了Audio Output，iOS平台即为AudioQueue。AudioQueue模块在工作过程中，通过不断的callback来获取pcm数据进行播放。</p> <ul><li>sdl_audio_callback</li></ul> <h2 id="audioqueue"><a href="#audioqueue" class="header-anchor">#</a> AudioQueue</h2> <p><em>XMind - Trial Version</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/iOS笔记/GPUImage.html" class="prev">
        GPUImage
      </a></span> <span class="next"><a href="/iOS笔记/iOS细节.html">
        iOS细节
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9de76d75.js" defer></script><script src="/assets/js/2.98ea7a63.js" defer></script><script src="/assets/js/63.cd3c1f6a.js" defer></script>
  </body>
</html>
