<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebAssembly | 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.9de76d75.js" as="script"><link rel="preload" href="/assets/js/2.98ea7a63.js" as="script"><link rel="preload" href="/assets/js/59.626b42b0.js" as="script"><link rel="prefetch" href="/assets/js/10.fa8eed47.js"><link rel="prefetch" href="/assets/js/11.f98f25e0.js"><link rel="prefetch" href="/assets/js/12.1ab9b5a3.js"><link rel="prefetch" href="/assets/js/13.75251b00.js"><link rel="prefetch" href="/assets/js/14.b5068189.js"><link rel="prefetch" href="/assets/js/15.33abd7e1.js"><link rel="prefetch" href="/assets/js/16.34ed8053.js"><link rel="prefetch" href="/assets/js/17.b3d52ea3.js"><link rel="prefetch" href="/assets/js/18.cbe71205.js"><link rel="prefetch" href="/assets/js/19.c632cb86.js"><link rel="prefetch" href="/assets/js/20.90d9a221.js"><link rel="prefetch" href="/assets/js/21.15cb7700.js"><link rel="prefetch" href="/assets/js/22.62ea968a.js"><link rel="prefetch" href="/assets/js/23.b743fdd5.js"><link rel="prefetch" href="/assets/js/24.5d157647.js"><link rel="prefetch" href="/assets/js/25.1935fba3.js"><link rel="prefetch" href="/assets/js/26.fd22f8ee.js"><link rel="prefetch" href="/assets/js/27.f47adfe7.js"><link rel="prefetch" href="/assets/js/28.d9f5719d.js"><link rel="prefetch" href="/assets/js/29.82cbf665.js"><link rel="prefetch" href="/assets/js/3.b96f613e.js"><link rel="prefetch" href="/assets/js/30.9f901f01.js"><link rel="prefetch" href="/assets/js/31.d9e2f61c.js"><link rel="prefetch" href="/assets/js/32.b14052e9.js"><link rel="prefetch" href="/assets/js/33.1b2e5efd.js"><link rel="prefetch" href="/assets/js/34.4bf7f44f.js"><link rel="prefetch" href="/assets/js/35.98d5fd2b.js"><link rel="prefetch" href="/assets/js/36.cdaf1c2f.js"><link rel="prefetch" href="/assets/js/37.a67bdb9a.js"><link rel="prefetch" href="/assets/js/38.5d856b83.js"><link rel="prefetch" href="/assets/js/39.27169c95.js"><link rel="prefetch" href="/assets/js/4.268c621c.js"><link rel="prefetch" href="/assets/js/40.8763c647.js"><link rel="prefetch" href="/assets/js/41.cd839f43.js"><link rel="prefetch" href="/assets/js/42.a97bf97a.js"><link rel="prefetch" href="/assets/js/43.fd126bb1.js"><link rel="prefetch" href="/assets/js/44.50e2b10d.js"><link rel="prefetch" href="/assets/js/45.0c29263b.js"><link rel="prefetch" href="/assets/js/46.fdee27aa.js"><link rel="prefetch" href="/assets/js/47.c7c7e966.js"><link rel="prefetch" href="/assets/js/48.80bc6f0a.js"><link rel="prefetch" href="/assets/js/49.d457b0ac.js"><link rel="prefetch" href="/assets/js/5.f577ebb9.js"><link rel="prefetch" href="/assets/js/50.cea3b0e6.js"><link rel="prefetch" href="/assets/js/51.eaab3e31.js"><link rel="prefetch" href="/assets/js/52.010a2dfb.js"><link rel="prefetch" href="/assets/js/53.3622f7b6.js"><link rel="prefetch" href="/assets/js/54.817aba2b.js"><link rel="prefetch" href="/assets/js/55.c3984ff9.js"><link rel="prefetch" href="/assets/js/56.6f20785e.js"><link rel="prefetch" href="/assets/js/57.07c7f6fc.js"><link rel="prefetch" href="/assets/js/58.4ec50d24.js"><link rel="prefetch" href="/assets/js/6.b9249342.js"><link rel="prefetch" href="/assets/js/60.ba2af5c7.js"><link rel="prefetch" href="/assets/js/61.6e22c298.js"><link rel="prefetch" href="/assets/js/62.df85ea27.js"><link rel="prefetch" href="/assets/js/63.cd3c1f6a.js"><link rel="prefetch" href="/assets/js/64.d0f75a86.js"><link rel="prefetch" href="/assets/js/65.12e0c392.js"><link rel="prefetch" href="/assets/js/66.aac422ac.js"><link rel="prefetch" href="/assets/js/67.3ff890c6.js"><link rel="prefetch" href="/assets/js/68.c6d12518.js"><link rel="prefetch" href="/assets/js/69.455e0c09.js"><link rel="prefetch" href="/assets/js/7.375eddd0.js"><link rel="prefetch" href="/assets/js/70.73d975e7.js"><link rel="prefetch" href="/assets/js/71.66528e07.js"><link rel="prefetch" href="/assets/js/72.a608a326.js"><link rel="prefetch" href="/assets/js/73.b8ed0811.js"><link rel="prefetch" href="/assets/js/74.68f4db5d.js"><link rel="prefetch" href="/assets/js/75.85059bdc.js"><link rel="prefetch" href="/assets/js/8.a04b9d9b.js"><link rel="prefetch" href="/assets/js/9.04a00c43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iOS笔记/工具.html" class="sidebar-link">工具</a></li><li><a href="/iOS笔记/计算机网络.html" class="sidebar-link">计算机网络</a></li><li><a href="/iOS笔记/架构.html" class="sidebar-link">架构</a></li><li><a href="/iOS笔记/视频播放器设计（基于FFmpeg）.html" class="sidebar-link">视频播放器设计（基于FFmpeg）</a></li><li><a href="/iOS笔记/视频常识.html" class="sidebar-link">视频常识</a></li><li><a href="/iOS笔记/数据结构与算法分析.html" class="sidebar-link">数据结构与算法分析</a></li><li><a href="/iOS笔记/算法.html" class="sidebar-link">算法</a></li><li><a href="/iOS笔记/音频常识.html" class="sidebar-link">音频常识</a></li><li><a href="/iOS笔记/音视频开发.html" class="sidebar-link">音视频开发</a></li><li><a href="/iOS笔记/直播.html" class="sidebar-link">直播</a></li><li><a href="/iOS笔记/App启动优化.html" class="sidebar-link">App启动优化</a></li><li><a href="/iOS笔记/Audio.html" class="sidebar-link">Audio</a></li><li><a href="/iOS笔记/AudioToolbox.html" class="sidebar-link">AudioToolbox</a></li><li><a href="/iOS笔记/AVFoundation.html" class="sidebar-link">AVFoundation</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C#</a></li><li><a href="/iOS笔记/C++.html" class="sidebar-link">C++</a></li><li><a href="/iOS笔记/CoreAudio.html" class="sidebar-link">CoreAudio</a></li><li><a href="/iOS笔记/CoreVideo.html" class="sidebar-link">CoreVideo</a></li><li><a href="/iOS笔记/FFmpeg.html" class="sidebar-link">FFmpeg</a></li><li><a href="/iOS笔记/Flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/iOS笔记/GPUImage.html" class="sidebar-link">GPUImage</a></li><li><a href="/iOS笔记/ijkPlayer.html" class="sidebar-link">ijkPlayer</a></li><li><a href="/iOS笔记/iOS细节.html" class="sidebar-link">iOS细节</a></li><li><a href="/iOS笔记/iOS性能优化.html" class="sidebar-link">iOS性能优化</a></li><li><a href="/iOS笔记/LFLiveKit.html" class="sidebar-link">LFLiveKit</a></li><li><a href="/iOS笔记/Metal.html" class="sidebar-link">Metal</a></li><li><a href="/iOS笔记/Objective-C.html" class="sidebar-link">Objective-C</a></li><li><a href="/iOS笔记/OpenGL相关概念.html" class="sidebar-link">OpenGL相关概念</a></li><li><a href="/iOS笔记/pthread.html" class="sidebar-link">pthread</a></li><li><a href="/iOS笔记/ReactNative.html" class="sidebar-link">React Native</a></li><li><a href="/iOS笔记/RunLoop.html" class="sidebar-link">RunLoop</a></li><li><a href="/iOS笔记/UI视图.html" class="sidebar-link">UI视图</a></li><li><a href="/iOS笔记/VideoToolbox.html" class="sidebar-link">VideoToolbox</a></li><li><a href="/iOS笔记/WebAssembly.html" class="active sidebar-link">WebAssembly</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#module" class="sidebar-link">Module</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#虚拟文件系统-同步访问" class="sidebar-link">虚拟文件系统(同步访问)</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#消息循环" class="sidebar-link">消息循环</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emcc-hello-world-sdl-cpp-o-hello-html-preload-file-hello-world-file-txt" class="sidebar-link">emcc helloworldsdl.cpp -o hello.html --preload-file helloworldfile.txt</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emcc-hello-world-c" class="sidebar-link">emcc hello_world.c</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#node-a-out-js" class="sidebar-link">node a.out.js</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#python3-m-http-server" class="sidebar-link">python3 -m http.server</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emcc-hello-world-c-o-hello-html" class="sidebar-link">emcc hello_world.c -o hello.html</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emrun-hello-html" class="sidebar-link">emrun hello.html</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emrun-list-browsers" class="sidebar-link">emrun --list_browsers</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emrun-browser-safari-hello-html" class="sidebar-link">emrun --browser safari hello.html</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#npm-run-build-wasm" class="sidebar-link">npm run build-wasm</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#和js的区别" class="sidebar-link">和js的区别</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#em-port-api" class="sidebar-link">EMPORTAPI</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#c-c-只能访问module-buffer当中的内存地址-无法访问其他原生的js地址" class="sidebar-link">C/C++只能访问Module.buffer当中的内存地址，无法访问其他原生的js地址</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#js和c进行数据传递及数据类型转换" class="sidebar-link">js和C进行数据传递及数据类型转换</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#ccall-cwrap" class="sidebar-link">ccall/cwrap</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#c嵌入js代码" class="sidebar-link">C嵌入js代码</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/WebAssembly.html#emcc命令" class="sidebar-link">emcc命令</a></li></ul></li><li><a href="/iOS笔记/WebRTC.html" class="sidebar-link">WebRTC</a></li><li><a href="/iOS笔记/第三方.html" class="sidebar-link">第三方</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webassembly"><a href="#webassembly" class="header-anchor">#</a> WebAssembly</h1> <h2 id="module"><a href="#module" class="header-anchor">#</a> Module</h2> <h3 id="module-onruntimeinitialized"><a href="#module-onruntimeinitialized" class="header-anchor">#</a> Module.onRuntimeInitialized</h3> <ul><li>回调在运行时准备就绪后执行测试代码</li></ul> <h3 id="module-total-memory"><a href="#module-total-memory" class="header-anchor">#</a> Module.TOTAL_MEMORY</h3> <ul><li>设置内存容量。</li></ul> <h3 id="module-print-function-e"><a href="#module-print-function-e" class="header-anchor">#</a> Module.print = function(e) {</h3> <div class="language- extra-class"><pre><code>	alert(e);
}
</code></pre></div><ul><li>更改Module的标准输出行为</li></ul> <h2 id="虚拟文件系统-同步访问"><a href="#虚拟文件系统-同步访问" class="header-anchor">#</a> 虚拟文件系统(同步访问)</h2> <h3 id="memfs"><a href="#memfs" class="header-anchor">#</a> MEMFS</h3> <ul><li><p>内存文件系统</p> <ul><li>该系统的数据完全存储于内存中，程序运行时写入的数据在页面刷新或程序重载后将丢失；</li></ul></li></ul> <h3 id="nodefs"><a href="#nodefs" class="header-anchor">#</a> NODEFS</h3> <ul><li><p>Node.js文件系统</p> <ul><li>该系统可以访问本地文件系统，可以持久化存储，但只能用于Node.js环境；</li></ul></li></ul> <h3 id="idbfs"><a href="#idbfs" class="header-anchor">#</a> IDBFS</h3> <ul><li><p>IndexedDB文件系统</p> <ul><li>该系统基于浏览器的IndexedDB对象，可以持久化存储，但只能用于浏览器环境。</li></ul></li></ul> <h2 id="消息循环"><a href="#消息循环" class="header-anchor">#</a> 消息循环</h2> <h3 id="void-emscripten-set-main-loop-em-callback-func-func-int-fps-int-simulate-infinite-loop"><a href="#void-emscripten-set-main-loop-em-callback-func-func-int-fps-int-simulate-infinite-loop" class="header-anchor">#</a> void emscripten_set_main_loop(em_callback_func func, int fps, int simulate_infinite_loop)</h3> <ul><li>func：消息处理回调函数。</li> <li>fps：消息循环的执行帧率。如果该参数小等于0，则使用页面的requestAnimationFrame机制调用消息处理函数，该机制可以确保页面刷新率与显示器刷新率对齐，对于需要执行图形渲染任务的程序，使用该机制可以得到平滑的渲染速度。</li> <li>simulate_infinite_loop：是否模拟“无限循环”，如果为1，则后续的方法将不调用，且main函数未销毁</li></ul> <h3 id="void-emscripten-set-main-loop-arg-em-arg-callback-func-func-void-arg-int-fps-int-simulate-infinite-loop"><a href="#void-emscripten-set-main-loop-arg-em-arg-callback-func-func-void-arg-int-fps-int-simulate-infinite-loop" class="header-anchor">#</a> void emscripten_set_main_loop_arg(em_arg_callback_func func, void *arg, int fps, int simulate_infinite_loop);</h3> <h3 id="void-emscripten-pause-main-loop-void"><a href="#void-emscripten-pause-main-loop-void" class="header-anchor">#</a> void emscripten_pause_main_loop(void)</h3> <ul><li>暂停</li></ul> <h3 id="void-emscripten-resume-main-loop-void"><a href="#void-emscripten-resume-main-loop-void" class="header-anchor">#</a> void emscripten_resume_main_loop(void)</h3> <ul><li>继续</li></ul> <h3 id="void-emscripten-cancel-main-loop-void"><a href="#void-emscripten-cancel-main-loop-void" class="header-anchor">#</a> void emscripten_cancel_main_loop(void)</h3> <ul><li>终止</li></ul> <h2 id="emcc-hello-world-sdl-cpp-o-hello-html-preload-file-hello-world-file-txt"><a href="#emcc-hello-world-sdl-cpp-o-hello-html-preload-file-hello-world-file-txt" class="header-anchor">#</a> emcc hello_world_sdl.cpp -o hello.html --preload-file hello_world_file.txt</h2> <h3 id="预加载文件进入虚拟文件系统"><a href="#预加载文件进入虚拟文件系统" class="header-anchor">#</a> 预加载文件进入虚拟文件系统</h3> <h2 id="emcc-hello-world-c"><a href="#emcc-hello-world-c" class="header-anchor">#</a> emcc hello_world.c</h2> <h3 id="将c-c-转成js和wasm"><a href="#将c-c-转成js和wasm" class="header-anchor">#</a> 将C/C++转成js和wasm</h3> <h3 id="o1、-o2-开启代码优化"><a href="#o1、-o2-开启代码优化" class="header-anchor">#</a> -O1、-O2...开启代码优化</h3> <h2 id="node-a-out-js"><a href="#node-a-out-js" class="header-anchor">#</a> node a.out.js</h2> <h3 id="运行js"><a href="#运行js" class="header-anchor">#</a> 运行js</h3> <h2 id="python3-m-http-server"><a href="#python3-m-http-server" class="header-anchor">#</a> python3 -m http.server</h2> <h3 id="启动当前目录的http服务器"><a href="#启动当前目录的http服务器" class="header-anchor">#</a> 启动当前目录的http服务器</h3> <h2 id="emcc-hello-world-c-o-hello-html"><a href="#emcc-hello-world-c-o-hello-html" class="header-anchor">#</a> emcc hello_world.c -o hello.html</h2> <h3 id="将cpp或者c转成html以便测试js和wasm"><a href="#将cpp或者c转成html以便测试js和wasm" class="header-anchor">#</a> 将cpp或者c转成html以便测试js和wasm</h3> <h2 id="emrun-hello-html"><a href="#emrun-hello-html" class="header-anchor">#</a> emrun hello.html</h2> <h3 id="运行html"><a href="#运行html" class="header-anchor">#</a> 运行html</h3> <h2 id="emrun-list-browsers"><a href="#emrun-list-browsers" class="header-anchor">#</a> emrun --list_browsers</h2> <h3 id="查看支持的浏览器"><a href="#查看支持的浏览器" class="header-anchor">#</a> 查看支持的浏览器</h3> <h2 id="emrun-browser-safari-hello-html"><a href="#emrun-browser-safari-hello-html" class="header-anchor">#</a> emrun --browser safari hello.html</h2> <h3 id="指定浏览器运行"><a href="#指定浏览器运行" class="header-anchor">#</a> 指定浏览器运行</h3> <h2 id="npm-run-build-wasm"><a href="#npm-run-build-wasm" class="header-anchor">#</a> npm run build-wasm</h2> <h3 id="编译到wasm-js"><a href="#编译到wasm-js" class="header-anchor">#</a> 编译到wasm+js</h3> <h2 id="和js的区别"><a href="#和js的区别" class="header-anchor">#</a> 和js的区别</h2> <h3 id="自己管理内存-没有js的垃圾回收机制"><a href="#自己管理内存-没有js的垃圾回收机制" class="header-anchor">#</a> 自己管理内存，没有js的垃圾回收机制</h3> <h3 id="静态类型"><a href="#静态类型" class="header-anchor">#</a> 静态类型</h3> <h2 id="em-port-api"><a href="#em-port-api" class="header-anchor">#</a> EM_PORT_API</h2> <h3 id="导出c函数到js"><a href="#导出c函数到js" class="header-anchor">#</a> 导出C函数到js</h3> <h3 id="也可以用此宏在c函数当中声明-在js当中进行实现"><a href="#也可以用此宏在c函数当中声明-在js当中进行实现" class="header-anchor">#</a> 也可以用此宏在C函数当中声明，在js当中进行实现</h3> <ul><li>mergeInto(LibraryManager.library, {
js_add: function})</li></ul> <h2 id="c-c-只能访问module-buffer当中的内存地址-无法访问其他原生的js地址"><a href="#c-c-只能访问module-buffer当中的内存地址-无法访问其他原生的js地址" class="header-anchor">#</a> C/C++只能访问Module.buffer当中的内存地址，无法访问其他原生的js地址</h2> <h3 id="指针类型为int32"><a href="#指针类型为int32" class="header-anchor">#</a> 指针类型为Int32</h3> <h2 id="js和c进行数据传递及数据类型转换"><a href="#js和c进行数据传递及数据类型转换" class="header-anchor">#</a> js和C进行数据传递及数据类型转换</h2> <h3 id="传递"><a href="#传递" class="header-anchor">#</a> 传递</h3> <ul><li><p>通过参数或者返回值Number</p> <ul><li>32位整型</li> <li>32位浮点型</li> <li>64位浮点型</li></ul></li> <li><p>字符串/数组等非Number类型</p> <ul><li><p>交换内存</p> <ul><li><p>js读取C数据</p> <ul><li><p>获取C当中的内存地址后通过js当中的Module.HEAP32来取值</p> <ul><li><p>Module.HEAP32[(ptr &gt;&gt; 2) + i]</p> <ul><li><p>通过传递ptr指针，然后在js当中通过ptr去取数据</p> <ul><li>free</li></ul></li></ul></li></ul></li></ul></li> <li><p>C读取js数据</p> <ul><li>js当中初始化指针Module._malloc</li> <li>初始化数据Module.HEAP32[ptr / 4 + i] = i + 1;</li> <li>调用C当中的方法Module._sum</li> <li>free</li></ul></li></ul></li></ul></li></ul> <h3 id="转换"><a href="#转换" class="header-anchor">#</a> 转换</h3> <ul><li><p>字符串</p> <ul><li>js当中使用Pointer_stringify(ptr)将C当中的字符串转换成js字符串</li> <li>js通过allocateUTF8(&quot;&quot;)方法在公共内存当中创建字符串，创建后记得free</li></ul></li> <li><p>字符类型转换</p> <ul><li>AsciiToString()</li> <li>stringToAscii()</li> <li>UTF8ArrayToString()</li> <li>stringToUTF8Array()</li></ul></li></ul> <h2 id="ccall-cwrap"><a href="#ccall-cwrap" class="header-anchor">#</a> ccall/cwrap</h2> <h3 id="js调用c"><a href="#js调用c" class="header-anchor">#</a> js调用C</h3> <ul><li><p>var result = Module.ccall(ident, returnType, argTypes, args);//result为调用结果</p> <ul><li>ident ：C导出函数的函数名（不含“_”下划线前缀）；</li> <li>returnType ：C导出函数的返回值类型，可以为'boolean'、'number'、'string'、'null'，分别表示函数返回值为布尔值、数值、字符串、无返回值；</li> <li>rgTypes ：C导出函数的参数类型的数组。参数类型可以为'number'、'string'、'array'，分别代表数值、字符串、数组；</li> <li>args ：参数数组。</li></ul></li> <li><p>var func = Module.cwrap(ident, returnType, argTypes);//func为方法</p> <ul><li>ident ：C导出函数的函数名（不含“_”下划线前缀）；</li> <li>returnType ：C导出函数的返回值类型，可以为'boolean'、'number'、'string'、'null'，分别表示函数返回值为布尔值、数值、字符串、无返回值；</li> <li>argTypes ：C导出函数的参数类型的数组。参数类型可以为'number'、'string'、'array'，分别代表数值、字符串、数组；</li></ul></li> <li><p>ccall/cwrap分配栈，需要避免爆栈</p></li></ul> <h2 id="c嵌入js代码"><a href="#c嵌入js代码" class="header-anchor">#</a> C嵌入js代码</h2> <h3 id="静态硬编码传入字符"><a href="#静态硬编码传入字符" class="header-anchor">#</a> 静态硬编码传入字符</h3> <ul><li><p>无参数和无返回值</p> <ul><li>EM_ASM(console.log(''你好));</li></ul></li> <li><p>参数和int返回值</p> <ul><li>int sum = EM_ASM_({return $0 + $1 + $2;}, 1, 2, 3);</li></ul></li> <li><p>参数和double返回值</p> <ul><li>double pi2 = EM_ASM_DOUBLE({return $0 * $1;}, pi, 2.0);</li></ul></li> <li><p>无参数和有int返回值</p> <ul><li>int answer = EM_ASM_INT_V(return 42);</li></ul></li> <li><p>无参数和有double返回值</p> <ul><li>double pi_js = EM_ASM_DOUBLE_V(return 3.14159);</li></ul></li></ul> <h3 id="动态编码js字符串"><a href="#动态编码js字符串" class="header-anchor">#</a> 动态编码js字符串</h3> <ul><li><p>有int返回值</p> <ul><li>int emscripten_run_script_int(const char *script)</li></ul></li> <li><p>有char *返回值</p> <ul><li>char *emscripten_run_script_string(const char *script)</li></ul></li> <li><p>无返回值</p> <ul><li>void emscripten_run_script(const char *script)</li></ul></li></ul> <h2 id="emcc命令"><a href="#emcc命令" class="header-anchor">#</a> emcc命令</h2> <h3 id="s-wasm-0"><a href="#s-wasm-0" class="header-anchor">#</a> -s WASM=0</h3> <ul><li>不使用wasm</li></ul> <h3 id="js-library-pkg-js"><a href="#js-library-pkg-js" class="header-anchor">#</a> --js-library pkg.js</h3> <ul><li>合并pkg.js当中的代码到emscripten，对于C声明，但实际实现在pkg.js当中的代码需要开启这个</li></ul> <h3 id="std-c-11"><a href="#std-c-11" class="header-anchor">#</a> -std=c++11</h3> <ul><li>原生当中使用了c++11相关的标准时，需要开启，例如字符串转义emscripten_run_script(R&quot;());</li></ul> <h3 id="s-extra-exported-runtime-methods-ccall-cwrap"><a href="#s-extra-exported-runtime-methods-ccall-cwrap" class="header-anchor">#</a> -s &quot;EXTRA_EXPORTED_RUNTIME_METHODS=['ccall', 'cwrap']&quot;</h3> <ul><li>开启ccall/cwrap调用</li></ul> <h3 id="s-no-exit-runtime-0"><a href="#s-no-exit-runtime-0" class="header-anchor">#</a> -s NO_EXIT_RUNTIME=0</h3> <ul><li>main函数返回后禁止js端在原生里面调用Module，即注销Emscripten运行时</li></ul> <h3 id="preload-file-hello-txt"><a href="#preload-file-hello-txt" class="header-anchor">#</a> --preload-file hello.txt</h3> <ul><li>将文件/文件夹打包成.data</li></ul> <h3 id="s-force-filesystem-1"><a href="#s-force-filesystem-1" class="header-anchor">#</a> -s FORCE_FILESYSTEM=1</h3> <ul><li>使用已经打包好的外部文件需要开启</li></ul> <h3 id="s-total-memory-67108864"><a href="#s-total-memory-67108864" class="header-anchor">#</a> -s TOTAL_MEMORY=67108864</h3> <ul><li><p>设置emscripten内存容量，默认为16MB，必须为64KB的整数倍，默认在运行时无法修改</p></li> <li><p>var Module = {
TOTAL_MEMORY : 134217728
}</p> <ul><li>通过javascript设置内存容量，但必须在emscripten装载前进行设置，设置后会覆盖默认值，且无法修改</li></ul></li></ul> <h3 id="s-total-stack-3145728"><a href="#s-total-stack-3145728" class="header-anchor">#</a> -s TOTAL_STACK=3145728</h3> <ul><li>设置栈容量，默认为5MB</li></ul> <h3 id="s-allow-memory-growth-1"><a href="#s-allow-memory-growth-1" class="header-anchor">#</a> -s ALLOW_MEMORY_GROWTH=1</h3> <ul><li>设置运行时可扩大内存容量，当编译目标为asm.js时，可变内存模式会影响性能，当编译目标为wasm时，可变内存模式非常高效，不会影响运行性能</li></ul> <h3 id="s-malloc-emmalloc"><a href="#s-malloc-emmalloc" class="header-anchor">#</a> -s MALLOC=&quot;emmalloc&quot;</h3> <ul><li><p>dlmalloc</p> <ul><li>默认值。由Doug Lea创建的内存分配器，其变种广泛使用于Linux等。如果频繁申请大量小片内存，使用dlmalloc性能较好</li></ul></li> <li><p>emmalloc</p> <ul><li>专为Emscripten设计的内存分配器。代码体积小于dlmalloc</li></ul></li></ul> <p><em>XMind - Trial Version</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/iOS笔记/VideoToolbox.html" class="prev">
        VideoToolbox
      </a></span> <span class="next"><a href="/iOS笔记/WebRTC.html">
        WebRTC
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9de76d75.js" defer></script><script src="/assets/js/2.98ea7a63.js" defer></script><script src="/assets/js/59.626b42b0.js" defer></script>
  </body>
</html>
