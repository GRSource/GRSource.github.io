<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AVFoundation | 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.9de76d75.js" as="script"><link rel="preload" href="/assets/js/2.98ea7a63.js" as="script"><link rel="preload" href="/assets/js/39.27169c95.js" as="script"><link rel="prefetch" href="/assets/js/10.fa8eed47.js"><link rel="prefetch" href="/assets/js/11.f98f25e0.js"><link rel="prefetch" href="/assets/js/12.1ab9b5a3.js"><link rel="prefetch" href="/assets/js/13.75251b00.js"><link rel="prefetch" href="/assets/js/14.b5068189.js"><link rel="prefetch" href="/assets/js/15.33abd7e1.js"><link rel="prefetch" href="/assets/js/16.34ed8053.js"><link rel="prefetch" href="/assets/js/17.b3d52ea3.js"><link rel="prefetch" href="/assets/js/18.cbe71205.js"><link rel="prefetch" href="/assets/js/19.c632cb86.js"><link rel="prefetch" href="/assets/js/20.90d9a221.js"><link rel="prefetch" href="/assets/js/21.15cb7700.js"><link rel="prefetch" href="/assets/js/22.62ea968a.js"><link rel="prefetch" href="/assets/js/23.b743fdd5.js"><link rel="prefetch" href="/assets/js/24.5d157647.js"><link rel="prefetch" href="/assets/js/25.1935fba3.js"><link rel="prefetch" href="/assets/js/26.fd22f8ee.js"><link rel="prefetch" href="/assets/js/27.f47adfe7.js"><link rel="prefetch" href="/assets/js/28.d9f5719d.js"><link rel="prefetch" href="/assets/js/29.82cbf665.js"><link rel="prefetch" href="/assets/js/3.b96f613e.js"><link rel="prefetch" href="/assets/js/30.9f901f01.js"><link rel="prefetch" href="/assets/js/31.d9e2f61c.js"><link rel="prefetch" href="/assets/js/32.b14052e9.js"><link rel="prefetch" href="/assets/js/33.1b2e5efd.js"><link rel="prefetch" href="/assets/js/34.4bf7f44f.js"><link rel="prefetch" href="/assets/js/35.98d5fd2b.js"><link rel="prefetch" href="/assets/js/36.cdaf1c2f.js"><link rel="prefetch" href="/assets/js/37.a67bdb9a.js"><link rel="prefetch" href="/assets/js/38.5d856b83.js"><link rel="prefetch" href="/assets/js/4.268c621c.js"><link rel="prefetch" href="/assets/js/40.8763c647.js"><link rel="prefetch" href="/assets/js/41.cd839f43.js"><link rel="prefetch" href="/assets/js/42.a97bf97a.js"><link rel="prefetch" href="/assets/js/43.fd126bb1.js"><link rel="prefetch" href="/assets/js/44.50e2b10d.js"><link rel="prefetch" href="/assets/js/45.0c29263b.js"><link rel="prefetch" href="/assets/js/46.fdee27aa.js"><link rel="prefetch" href="/assets/js/47.c7c7e966.js"><link rel="prefetch" href="/assets/js/48.80bc6f0a.js"><link rel="prefetch" href="/assets/js/49.d457b0ac.js"><link rel="prefetch" href="/assets/js/5.f577ebb9.js"><link rel="prefetch" href="/assets/js/50.cea3b0e6.js"><link rel="prefetch" href="/assets/js/51.eaab3e31.js"><link rel="prefetch" href="/assets/js/52.010a2dfb.js"><link rel="prefetch" href="/assets/js/53.3622f7b6.js"><link rel="prefetch" href="/assets/js/54.817aba2b.js"><link rel="prefetch" href="/assets/js/55.c3984ff9.js"><link rel="prefetch" href="/assets/js/56.6f20785e.js"><link rel="prefetch" href="/assets/js/57.07c7f6fc.js"><link rel="prefetch" href="/assets/js/58.4ec50d24.js"><link rel="prefetch" href="/assets/js/59.626b42b0.js"><link rel="prefetch" href="/assets/js/6.b9249342.js"><link rel="prefetch" href="/assets/js/60.ba2af5c7.js"><link rel="prefetch" href="/assets/js/61.6e22c298.js"><link rel="prefetch" href="/assets/js/62.df85ea27.js"><link rel="prefetch" href="/assets/js/63.cd3c1f6a.js"><link rel="prefetch" href="/assets/js/64.d0f75a86.js"><link rel="prefetch" href="/assets/js/65.12e0c392.js"><link rel="prefetch" href="/assets/js/66.aac422ac.js"><link rel="prefetch" href="/assets/js/67.3ff890c6.js"><link rel="prefetch" href="/assets/js/68.c6d12518.js"><link rel="prefetch" href="/assets/js/69.455e0c09.js"><link rel="prefetch" href="/assets/js/7.375eddd0.js"><link rel="prefetch" href="/assets/js/70.73d975e7.js"><link rel="prefetch" href="/assets/js/71.66528e07.js"><link rel="prefetch" href="/assets/js/72.a608a326.js"><link rel="prefetch" href="/assets/js/73.b8ed0811.js"><link rel="prefetch" href="/assets/js/74.68f4db5d.js"><link rel="prefetch" href="/assets/js/75.85059bdc.js"><link rel="prefetch" href="/assets/js/8.a04b9d9b.js"><link rel="prefetch" href="/assets/js/9.04a00c43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iOS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>iOS笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/iOS笔记/工具.html" class="sidebar-link">工具</a></li><li><a href="/iOS笔记/计算机网络.html" class="sidebar-link">计算机网络</a></li><li><a href="/iOS笔记/架构.html" class="sidebar-link">架构</a></li><li><a href="/iOS笔记/视频播放器设计（基于FFmpeg）.html" class="sidebar-link">视频播放器设计（基于FFmpeg）</a></li><li><a href="/iOS笔记/视频常识.html" class="sidebar-link">视频常识</a></li><li><a href="/iOS笔记/数据结构与算法分析.html" class="sidebar-link">数据结构与算法分析</a></li><li><a href="/iOS笔记/算法.html" class="sidebar-link">算法</a></li><li><a href="/iOS笔记/音频常识.html" class="sidebar-link">音频常识</a></li><li><a href="/iOS笔记/音视频开发.html" class="sidebar-link">音视频开发</a></li><li><a href="/iOS笔记/直播.html" class="sidebar-link">直播</a></li><li><a href="/iOS笔记/App启动优化.html" class="sidebar-link">App启动优化</a></li><li><a href="/iOS笔记/Audio.html" class="sidebar-link">Audio</a></li><li><a href="/iOS笔记/AudioToolbox.html" class="sidebar-link">AudioToolbox</a></li><li><a href="/iOS笔记/AVFoundation.html" class="active sidebar-link">AVFoundation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avaudiosession" class="sidebar-link">AVAudioSession</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avcapturesession" class="sidebar-link">AVCaptureSession</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avcapturedeviceinput" class="sidebar-link">AVCaptureDeviceInput</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avcapturevideodataoutput" class="sidebar-link">AVCaptureVideoDataOutput</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avcapturedevice" class="sidebar-link">AVCaptureDevice</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avassetreader" class="sidebar-link">AVAssetReader</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#视频编辑及合并流程" class="sidebar-link">视频编辑及合并流程</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#setpreferrediobufferduration" class="sidebar-link">setPreferredIOBufferDuration</a></li><li class="sidebar-sub-header"><a href="/iOS笔记/AVFoundation.html#avaudiosessionport" class="sidebar-link">AVAudioSessionPort</a></li></ul></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C</a></li><li><a href="/iOS笔记/C.html#.html" class="sidebar-link">C#</a></li><li><a href="/iOS笔记/C++.html" class="sidebar-link">C++</a></li><li><a href="/iOS笔记/CoreAudio.html" class="sidebar-link">CoreAudio</a></li><li><a href="/iOS笔记/CoreVideo.html" class="sidebar-link">CoreVideo</a></li><li><a href="/iOS笔记/FFmpeg.html" class="sidebar-link">FFmpeg</a></li><li><a href="/iOS笔记/Flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/iOS笔记/GPUImage.html" class="sidebar-link">GPUImage</a></li><li><a href="/iOS笔记/ijkPlayer.html" class="sidebar-link">ijkPlayer</a></li><li><a href="/iOS笔记/iOS细节.html" class="sidebar-link">iOS细节</a></li><li><a href="/iOS笔记/iOS性能优化.html" class="sidebar-link">iOS性能优化</a></li><li><a href="/iOS笔记/LFLiveKit.html" class="sidebar-link">LFLiveKit</a></li><li><a href="/iOS笔记/Metal.html" class="sidebar-link">Metal</a></li><li><a href="/iOS笔记/Objective-C.html" class="sidebar-link">Objective-C</a></li><li><a href="/iOS笔记/OpenGL相关概念.html" class="sidebar-link">OpenGL相关概念</a></li><li><a href="/iOS笔记/pthread.html" class="sidebar-link">pthread</a></li><li><a href="/iOS笔记/ReactNative.html" class="sidebar-link">React Native</a></li><li><a href="/iOS笔记/RunLoop.html" class="sidebar-link">RunLoop</a></li><li><a href="/iOS笔记/UI视图.html" class="sidebar-link">UI视图</a></li><li><a href="/iOS笔记/VideoToolbox.html" class="sidebar-link">VideoToolbox</a></li><li><a href="/iOS笔记/WebAssembly.html" class="sidebar-link">WebAssembly</a></li><li><a href="/iOS笔记/WebRTC.html" class="sidebar-link">WebRTC</a></li><li><a href="/iOS笔记/第三方.html" class="sidebar-link">第三方</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="avfoundation"><a href="#avfoundation" class="header-anchor">#</a> AVFoundation</h1> <h2 id="avaudiosession"><a href="#avaudiosession" class="header-anchor">#</a> AVAudioSession</h2> <h3 id="preferredsamplerate"><a href="#preferredsamplerate" class="header-anchor">#</a> preferredSampleRate</h3> <h3 id="category"><a href="#category" class="header-anchor">#</a> category</h3> <ul><li><p>[session setCategory:AVAudioSessionCategoryPlayAndRecord withOptions:AVAudioSessionCategoryOptionDefaultToSpeaker | AVAudioSessionCategoryOptionInterruptSpokenAudioAndMixWithOthers error:nil];</p> <ul><li>用于录音和播放，打开免提，并中断其他app的播放，不管其他app是否支持混音</li></ul></li></ul> <h3 id="setactive"><a href="#setactive" class="header-anchor">#</a> setActive</h3> <p>激活session</p> <ul><li><p>因为AVAudioSession会影响其他App的表现，当自己App的Session被激活，其他App的就会被解除激活，如何要让自己的Session解除激活后恢复其他App Session的激活状态呢？</p> <ul><li>(BOOL)setActive:(BOOL)active
withOptions:(AVAudioSessionSetActiveOptions)options
error:(NSError * _Nullable *)outError;</li></ul></li></ul> <p>这里的options传入AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation 即可。</p> <h3 id="七大类别category-setcategory-方法"><a href="#七大类别category-setcategory-方法" class="header-anchor">#</a> 七大类别Category(setCategory:方法)</h3> <p>AVAudioSession主要能控制App的哪些表现以及如何控制的呢？首先AVAudioSession将使用音频的场景分成七大类，通过设置Session为不同的类别，可以控制：</p> <p>当App激活Session的时候，是否会打断其他不支持混音的App声音
当用户触发手机上的“静音”键时或者锁屏时，是否相应静音
当前状态是否支持录音
当前状态是否支持播放
每个App启动时都会设置成上面说的默认状态，即其他App会被中断同时相应“静音”键的播放模式。</p> <ul><li><p>AVAudioSessionCategoryAmbient</p> <p>只用于播放音乐时，并且可以和QQ音乐同时播放，比如玩游戏的时候还想听QQ音乐的歌，那么把游戏播放背景音就设置成这种类别。同时，当用户锁屏或者静音时也会随着静音，这种类别基本适用所有App的背景场景。</p> <ul><li><p>当按“静音”或者锁屏是否静音：是</p> <ul><li><p>是否引起不支持混音的App中断：否</p> <ul><li>是否支持录音和播放：只支持播放</li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionCategorySoloAmbient</p> <p>也是只用于播放,但是和&quot;AVAudioSessionCategoryAmbient&quot;不同的是，用了它就别想听QQ音乐了，比如不希望QQ音乐干扰的App，类似节奏大师。同样当用户锁屏或者静音时也会随着静音，锁屏了就玩不了节奏大师了。</p> <ul><li><p>当按“静音”或者锁屏是否静音：是</p> <ul><li><p>是否引起不支持混音的App中断：是</p> <ul><li>是否支持录音和播放：只用于播放</li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionCategoryAudioProcessing</p> <p>主要用于音频格式处理，一般可以配合AudioUnit进行使用</p> <ul><li>是否引起不支持混音的App中断：都不</li></ul></li> <li><p>AVAudioSessionCategoryMultiRoute</p> <p>想象一个DJ用的App，手机连着HDMI到扬声器播放当前的音乐，然后耳机里面播放下一曲，这种常人不理解的场景，这个类别可以支持多个设备输入输出。</p> <ul><li><p>当按“静音”或者锁屏是否静音：否</p> <ul><li><p>是否引起不支持混音的App中断：是</p> <ul><li>是否支持录音和播放：既可以录音也可以播放</li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionCategoryPlayAndRecord</p> <p>如果既想播放又想录制该用什么模式呢？比如VoIP，打电话这种场景，PlayAndRecord就是专门为这样的场景设计的 。</p> <ul><li><p>当按“静音”或者锁屏是否静音：否</p> <ul><li><p>是否引起不支持混音的App中断：默认不引起</p> <ul><li>是否支持录音和播放：既可以录音也可以播放</li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionCategoryPlayback</p> <p>如果锁屏了还想听声音怎么办？用这个类别，比如App本身就是播放器，同时当App播放时，其他类似QQ音乐就不能播放了。所以这种类别一般用于播放器类App</p> <ul><li><p>当按“静音”或者锁屏是否静音：否</p> <ul><li><p>是否引起不支持混音的App中断：默认引起</p> <ul><li>是否支持录音和播放：只用于播放</li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionCategoryRecord</p> <p>有了播放器，肯定要录音机，比如微信语音的录制，就要用到这个类别，既然要安静的录音，肯定不希望有QQ音乐了，所以其他播放声音会中断。想想微信语音的场景，就知道什么时候用他了。</p> <ul><li><p>当按“静音”或者锁屏是否静音：否</p> <ul><li><p>是否引起不支持混音的App中断：是</p> <ul><li>是否支持录音和播放：只用于录音</li></ul></li></ul></li></ul></li></ul> <h3 id="category的7大选项options"><a href="#category的7大选项options" class="header-anchor">#</a> category的7大选项options</h3> <p>上面介绍的这个七大类别，可以认为是设定了七种主场景，而这七类肯定是不能满足开发者所有的需求的。CoreAudio提供的方法是，首先定下七种的一种基调，然后在进行微调。CoreAudio为每种Category都提供了些许选项来进行微调。</p> <ul><li><p>AVAudioSessionCategoryOptionMixWithOthers</p> <p>如果确实用的AVAudioSessionCategoryPlayback实现的一个背景音，但是呢，又想和QQ音乐并存，那么可以在AVAudioSessionCategoryPlayback类别下在设置这个选项，就可以实现共存了。</p> <ul><li><p>适用类别</p> <ul><li>AVAudioSessionCategoryPlayAndRecord</li> <li>AVAudioSessionCategoryPlayback</li> <li>AVAudioSessionCategoryMultiRoute</li></ul></li></ul></li> <li><p>AVAudioSessionCategoryOptionDuckOthers</p> <p>在实时通话的场景，比如QQ音乐，当进行视频通话的时候，会发现QQ音乐自动声音降低了，此时就是通过设置这个选项来对其他音乐App进行了压制。</p> <ul><li><p>适用类别</p> <ul><li>AVAudioSessionCategoryAmbient</li> <li>AVAudioSessionCategoryPlayAndRecord</li> <li>AVAudioSessionCategoryPlayback</li> <li>AVAudioSessionCategoryMultiRoute</li></ul></li></ul></li> <li><p>AVAudioSessionCategoryOptionAllowBluetooth</p> <p>如果要支持蓝牙耳机电话，则需要设置这个选项</p> <ul><li><p>适用类别</p> <ul><li>AVAudioSessionCategoryRecord</li> <li>AVAudioSessionCategoryPlayAndRecord</li></ul></li></ul></li> <li><p>AVAudioSessionCategoryOptionDefaultToSpeaker</p> <p>如果在VoIP模式下，希望默认打开免提功能，需要设置这个选项</p> <ul><li><p>适用类别</p> <ul><li>AVAudioSessionCategoryPlayAndRecord</li></ul></li></ul></li> <li><p>AVAudioSessionCategoryOptionInterruptSpokenAudioAndMixWithOthers</p></li> <li><p>AVAudioSessionCategoryOptionAllowBluetoothA2DP</p> <p>用于支持蓝牙A2DP耳机</p></li> <li><p>AVAudioSessionCategoryOptionAllowAirPlay</p> <p>AirPlay</p></li></ul> <h3 id="七大模式-setmode"><a href="#七大模式-setmode" class="header-anchor">#</a> 七大模式(setMode:)</h3> <p>刚讲完七大类别，现在再来七大模式。通过上面的七大类别，我们基本覆盖了常用的主场景，在每个主场景中可以通过Option进行微调。为此CoreAudio提供了七大比较常见微调后的子场景。叫做各个类别的模式。        每个模式有其适用的类别，所以，并不是有“七七 四十九”种组合。如果当前处于的类别下没有这个模式，那么是设置不成功的。设置完Category后可以通过availableModes属性，查看其支持哪些属性，做合法性校验。</p> <ul><li><p>AVAudioSessionModeDefault</p> <p>每种类别默认的就是这个模式，所有要想还原的话，就设置成这个模式。</p> <ul><li><p>适用的类别</p> <ul><li><p>所有类别</p> <ul><li><p>场景</p> <ul><li>默认的模式</li></ul></li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionModeVoiceChat</p> <p>主要用于VoIP场景，此时系统会选择最佳的输入设备，比如插上耳机就使用耳机上的麦克风进行采集。此时有个副作用，他会设置类别的选项为&quot;AVAudioSessionCategoryOptionAllowBluetooth&quot;从而支持蓝牙耳机。</p> <ul><li><p>适用的类别</p> <ul><li><p>AVAudioSessionCategoryPlayAndRecord</p> <ul><li><p>场景</p> <ul><li>VoIP</li></ul></li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionModeGameChat</p> <p>适用于游戏App的采集和播放，比如“GKVoiceChat”对象，一般不需要手动设置</p> <ul><li><p>适用的类别</p> <ul><li><p>AVAudioSessionCategoryPlayAndRecord</p> <ul><li><p>场景</p> <ul><li>游戏录制，由GKVoiceChat自动设置，无需手动调用</li></ul></li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionModeVideoRecording</p> <ul><li><p>适用的类别</p> <ul><li><p>AVAudioSessionCategoryPlayAndRecord，AVAudioSessionCategoryRecord</p> <ul><li><p>场景</p> <ul><li>录制视频时</li></ul></li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionModeMoviePlayback</p> <ul><li><p>适用的类别</p> <ul><li><p>AVAudioSessionCategoryPlayback</p> <ul><li><p>场景</p> <ul><li>视频播放</li></ul></li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionModeMeasurement</p> <ul><li><p>适用的类别</p> <ul><li><p>AVAudioSessionCategoryPlayAndRecord，AVAudioSessionCategoryRecord ，AVAudioSessionCategoryPlayback</p> <ul><li><p>场景</p> <ul><li>最小系统</li></ul></li></ul></li></ul></li></ul></li> <li><p>AVAudioSessionModeVideoChat</p> <p>主要用于视频通话，比如QQ视频、FaceTime。时系统也会选择最佳的输入设备，比如插上耳机就使用耳机上的麦克风进行采集并且会设置类别的选项为&quot;AVAudioSessionCategoryOptionAllowBluetooth&quot; 和 &quot;AVAudioSessionCategoryOptionDefaultToSpeaker&quot;。</p> <ul><li><p>适用的类别</p> <ul><li><p>AVAudioSessionCategoryPlayAndRecord</p> <ul><li><p>场景</p> <ul><li>视频通话</li></ul></li></ul></li></ul></li></ul></li></ul> <h3 id="notification"><a href="#notification" class="header-anchor">#</a> Notification</h3> <p>上面说的这些Category啊、Option啊以及Mode都是对自己作为播放主体时的表现，但是假设，现在正在播放着，突然来电话了、闹钟响了或者你在后台放歌但是用户启动其他App用上面的方法影响的时候，我们的App该如何表现呢？最常用的场景当然是先暂停，待恢复的时候再继续。那我们的App要如何感知到这个终端以及何时恢复呢？
AVAudioSession提供了多种Notifications来进行此类状况的通知。</p> <ul><li><p>AVAudioSessionInterruptionNotification</p> <p>来电话、闹铃响等都归结为一般性的中断，用
AVAudioSessionInterruptionNotification来通知。其回调回来的userInfo主要包含两键。</p> <ul><li><p>AVAudioSessionInterruptionTypeKey</p> <ul><li><p>AVAudioSessionInterruptionTypeBegan</p> <p>中断开始，我们应该暂停播放和采集</p></li> <li><p>AVAudioSessionInterruptionTypeEnded</p> <p>中断结束，我们可以继续播放和采集。</p></li></ul></li> <li><p>AVAudioSessionInterruptionOptionKey</p> <ul><li><p>AVAudioSessionInterruptionOptionShouldResume</p> <p>当前只有一种值AVAudioSessionInterruptionOptionShouldResume表示此时也应该恢复继续播放和采集。</p></li></ul></li></ul></li> <li><p>AVAudioSessionSilenceSecondaryAudioHintNotification</p> <p>而将其他App占据AudioSession的时候用AVAudioSessionSilenceSecondaryAudioHintNotification来进行通知。其回调回来的userInfo键为：</p> <ul><li><p>AVAudioSessionSilenceSecondaryAudioHintTypeKey</p> <ul><li><p>AVAudioSessionSilenceSecondaryAudioHintTypeBegin</p> <p>表示其他App开始占据Session</p></li> <li><p>AVAudioSessionSilenceSecondaryAudioHintTypeEnd</p> <p>表示其他App开始释放Session</p></li></ul></li></ul></li> <li><p>AVAudioSessionRouteChangeNotification</p> <p>播放设备的改变，例如耳机，扬声器等，它的userInfo中有键：</p> <ul><li><p>AVAudioSessionRouteChangeReasonKey</p> <p>表示改变的原因</p> <ul><li><p>AVAudioSessionRouteChangeReasonUnknown</p> <ul><li>未知原因</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonNewDeviceAvailable</p> <ul><li>有新设备可用</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonOldDeviceUnavailable</p> <ul><li>老设备不可用</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonCategoryChange</p> <ul><li>类别改变了</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonOverride</p> <ul><li>App重置了输出设置</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonWakeFromSleep</p> <ul><li>从睡眠状态呼醒</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonNoSuitableRouteForCategory</p> <ul><li>当前Category下没有合适的设备</li></ul></li> <li><p>AVAudioSessionRouteChangeReasonRouteConfigurationChange</p> <ul><li>Rotuer的配置改变了</li></ul></li></ul></li></ul></li></ul> <h3 id="setactive的options"><a href="#setactive的options" class="header-anchor">#</a> setActive的options</h3> <ul><li><p>kAudioSessionSetActiveFlag_NotifyOthersOnDeactivation</p> <p>解除其他app的激活状态</p></li></ul> <h2 id="avcapturesession"><a href="#avcapturesession" class="header-anchor">#</a> AVCaptureSession</h2> <h3 id="beginconfiguration"><a href="#beginconfiguration" class="header-anchor">#</a> beginConfiguration</h3> <p>指示要原子化地进行的一组配置更改的开始</p> <h3 id="if-capturesession-canaddinput-videoinput"><a href="#if-capturesession-canaddinput-videoinput" class="header-anchor">#</a> if ([_captureSession canAddInput:videoInput])</h3> <div class="language- extra-class"><pre><code>{
	[_captureSession addInput:videoInput];
}
</code></pre></div><p>设置输入设备</p> <h3 id="if-capturesession-canaddoutput-videooutput"><a href="#if-capturesession-canaddoutput-videooutput" class="header-anchor">#</a> if ([_captureSession canAddOutput:videoOutput])</h3> <div class="language- extra-class"><pre><code>{
	[_captureSession addOutput:videoOutput];
}
</code></pre></div><p>设置输出设备AVCaptureVideoDataOutput</p> <h3 id="setsessionpreset-设置分辨率"><a href="#setsessionpreset-设置分辨率" class="header-anchor">#</a> setSessionPreset：设置分辨率</h3> <h3 id="commitconfiguration"><a href="#commitconfiguration" class="header-anchor">#</a> commitConfiguration</h3> <p>提交一组配置更改</p> <h2 id="avcapturedeviceinput"><a href="#avcapturedeviceinput" class="header-anchor">#</a> AVCaptureDeviceInput</h2> <p>输入</p> <h3 id="avcapturedeviceinput-alloc-initwithdevice-inputcamera-error-error"><a href="#avcapturedeviceinput-alloc-initwithdevice-inputcamera-error-error" class="header-anchor">#</a> [[AVCaptureDeviceInput alloc] initWithDevice:_inputCamera error:&amp;error];</h3> <h2 id="avcapturevideodataoutput"><a href="#avcapturevideodataoutput" class="header-anchor">#</a> AVCaptureVideoDataOutput</h2> <p>输出数据</p> <h3 id="videooutput-avcapturevideodataoutput-alloc-init"><a href="#videooutput-avcapturevideodataoutput-alloc-init" class="header-anchor">#</a> videoOutput = [[AVCaptureVideoDataOutput alloc] init];</h3> <div class="language- extra-class"><pre><code>[videoOutput setAlwaysDiscardsLateVideoFrames:NO];
</code></pre></div><h3 id="availablevideocvpixelformattypes"><a href="#availablevideocvpixelformattypes" class="header-anchor">#</a> availableVideoCVPixelFormatTypes</h3> <p>获取支持的像素格式类型</p> <ul><li>GPUImage使用的是kCVPixelFormatType_420YpCbCr8BiPlanarFullRange，也就是420f</li></ul> <h3 id="setvideosettings"><a href="#setvideosettings" class="header-anchor">#</a> setVideoSettings:</h3> <ul><li>[videoOutput setVideoSettings:[NSDictionary dictionaryWithObject:[NSNumber numberWithInt:kCVPixelFormatType_420YpCbCr8BiPlanarFullRange] forKey:(id)kCVPixelBufferPixelFormatTypeKey]];</li></ul> <h3 id="setsamplebufferdelegate-设置采样代理-在代理方法中获取数据"><a href="#setsamplebufferdelegate-设置采样代理-在代理方法中获取数据" class="header-anchor">#</a> setSampleBufferDelegate:设置采样代理，在代理方法中获取数据</h3> <ul><li><ul><li>(void)captureOutput:(AVCaptureOutput *)output didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection;</li></ul></li> <li><ul><li>(void)captureOutput:(AVCaptureOutput *)output didDropSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection</li></ul></li></ul> <h2 id="avcapturedevice"><a href="#avcapturedevice" class="header-anchor">#</a> AVCaptureDevice</h2> <h3 id="前置摄像头"><a href="#前置摄像头" class="header-anchor">#</a> 前置摄像头</h3> <h3 id="后置摄像头"><a href="#后置摄像头" class="header-anchor">#</a> 后置摄像头</h3> <h2 id="avassetreader"><a href="#avassetreader" class="header-anchor">#</a> AVAssetReader</h2> <h2 id="视频编辑及合并流程"><a href="#视频编辑及合并流程" class="header-anchor">#</a> 视频编辑及合并流程</h2> <h3 id="avassetexportsession视频导出工具类"><a href="#avassetexportsession视频导出工具类" class="header-anchor">#</a> AVAssetExportSession视频导出工具类</h3> <ul><li><p>AVMutableComposition包含多个轨道的媒体信息，可以添加、删除轨道</p> <ul><li>将视频及音频资源添加到轨道之内</li></ul></li> <li><p>AVMutableVideoComposition视频操作指令集合</p> <ul><li><p>AVMutableVideoCompositionInstruction 视频操作指令</p> <ul><li>AVMutableVideoCompositionLayerInstruction视频轨道操作指令</li></ul></li> <li><p>AVVideoCompositing视频合并及像素处理协议</p></li> <li><p>AVVideoCompositionCoreAnimationTool添加Layer图层动画</p></li></ul></li></ul> <h2 id="setpreferrediobufferduration"><a href="#setpreferrediobufferduration" class="header-anchor">#</a> setPreferredIOBufferDuration</h2> <p>I/O缓冲时间是指单音频输入/输出周期的时长。比如说I/O缓冲时间为0.005s，那么在每一个音频I/O周期里，在获取输入时，会收到0.005s的音频，在输出时，必须提供0.005s的音频。buffer越小延迟越低</p> <h3 id="设置首选i-o缓冲时间"><a href="#设置首选i-o缓冲时间" class="header-anchor">#</a> 设置首选I/O缓冲时间</h3> <h2 id="avaudiosessionport"><a href="#avaudiosessionport" class="header-anchor">#</a> AVAudioSessionPort</h2> <h3 id="avaudiosessionportlineout"><a href="#avaudiosessionportlineout" class="header-anchor">#</a> AVAudioSessionPortLineOut</h3> <p>线路级输出到总线坞</p> <h3 id="avaudiosessionportheadphones"><a href="#avaudiosessionportheadphones" class="header-anchor">#</a> AVAudioSessionPortHeadphones</h3> <p>输出到有线耳机</p> <h3 id="avaudiosessionportbuiltinreceiver"><a href="#avaudiosessionportbuiltinreceiver" class="header-anchor">#</a> AVAudioSessionPortBuiltInReceiver</h3> <p>贴耳朵时候内置扬声器（打电话的时候的听筒）</p> <h3 id="avaudiosessionportbuiltinspeaker"><a href="#avaudiosessionportbuiltinspeaker" class="header-anchor">#</a> AVAudioSessionPortBuiltInSpeaker</h3> <p>输出到设备的内置扬声器。(iOS设备内置的扬声器)</p> <h3 id="avaudiosessionporthdmi"><a href="#avaudiosessionporthdmi" class="header-anchor">#</a> AVAudioSessionPortHDMI</h3> <p>通过高清多媒体接口（HDMI）规范输出到设备。</p> <h3 id="avaudiosessionportairplay"><a href="#avaudiosessionportairplay" class="header-anchor">#</a> AVAudioSessionPortAirPlay</h3> <p>远程AirPlay设备</p> <h3 id="avaudiosessionportbluetootha2dp"><a href="#avaudiosessionportbluetootha2dp" class="header-anchor">#</a> AVAudioSessionPortBluetoothA2DP</h3> <p>输出到蓝牙A2DP(Advanced Audio Distribution Profile)设备，A2DP 协议一般用来听歌，传输音频立体声。</p> <h3 id="avaudiosessionportbluetoothle"><a href="#avaudiosessionportbluetoothle" class="header-anchor">#</a> AVAudioSessionPortBluetoothLE</h3> <p>蓝牙低电量输出设备，Low Energy (LE)</p> <h3 id="avaudiosessionportbluetoothhfp"><a href="#avaudiosessionportbluetoothhfp" class="header-anchor">#</a> AVAudioSessionPortBluetoothHFP</h3> <p>HFP 协议一般用来支持耳机打电话、接电话、挂断电话、拒接电话等操作。</p> <h3 id="avaudiosessionportheadsetmic"><a href="#avaudiosessionportheadsetmic" class="header-anchor">#</a> AVAudioSessionPortHeadsetMic</h3> <p>有线耳机的麦克风</p> <h3 id="avaudiosessionportbuiltinmic"><a href="#avaudiosessionportbuiltinmic" class="header-anchor">#</a> AVAudioSessionPortBuiltInMic</h3> <p>内置麦克风</p> <h3 id="avaudiosessionportusbaudio"><a href="#avaudiosessionportusbaudio" class="header-anchor">#</a> AVAudioSessionPortUSBAudio</h3> <p>USB连接的设备</p> <h3 id="avaudiosessionportcaraudio"><a href="#avaudiosessionportcaraudio" class="header-anchor">#</a> AVAudioSessionPortCarAudio</h3> <p>车载音频设备</p> <p><em>XMind - Trial Version</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/iOS笔记/AudioToolbox.html" class="prev">
        AudioToolbox
      </a></span> <span class="next"><a href="/iOS笔记/C.html#.html">
        C
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9de76d75.js" defer></script><script src="/assets/js/2.98ea7a63.js" defer></script><script src="/assets/js/39.27169c95.js" defer></script>
  </body>
</html>
