(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{607:function(a,v,_){"use strict";_.r(v);var t=_(65),s=Object(t.a)({},(function(){var a=this,v=a.$createElement,_=a._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[_("h1",{attrs:{id:"ios性能优化"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ios性能优化"}},[a._v("#")]),a._v(" iOS性能优化")]),a._v(" "),_("h2",{attrs:{id:"性能监控"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#性能监控"}},[a._v("#")]),a._v(" 性能监控")]),a._v(" "),_("h3",{attrs:{id:"网络监控"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#网络监控"}},[a._v("#")]),a._v(" 网络监控")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("NSURLProtocol")]),a._v(" "),_("ul",[_("li",[a._v("只支持FTP/HTTP/HTTPS等应用层协议")]),a._v(" "),_("li",[a._v("通过继承该类并实现session代理方法来截取行为")])])]),a._v(" "),_("li",[_("p",[a._v("hook")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("CFNetwork")]),a._v(" "),_("ul",[_("li",[a._v("Fishhook")])])]),a._v(" "),_("li",[_("p",[a._v("URLSession")]),a._v(" "),_("ul",[_("li",[a._v("Method Swizzling")]),a._v(" "),_("li",[a._v("NSProxy")])])])])]),a._v(" "),_("li",[_("p",[a._v("关键指标")]),a._v(" "),_("ul",[_("li",[a._v("TCP建立连接时间")]),a._v(" "),_("li",[a._v("DNS时间")]),a._v(" "),_("li",[a._v("SSL时间")]),a._v(" "),_("li",[a._v("首包时间")]),a._v(" "),_("li",[a._v("响应时间")]),a._v(" "),_("li",[a._v("HTTP错误率")]),a._v(" "),_("li",[a._v("网络错误率")]),a._v(" "),_("li",[a._v("流量")])])])]),a._v(" "),_("h3",{attrs:{id:"采集"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#采集"}},[a._v("#")]),a._v(" 采集")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("耗电量监控")]),a._v(" "),_("ul",[_("li",[a._v("UIDevice获取电量统计")])])]),a._v(" "),_("li",[_("p",[a._v("CPU占用率")]),a._v(" "),_("ul",[_("li",[a._v("通过mach api获取")])])]),a._v(" "),_("li",[_("p",[a._v("内存使用情况")])]),a._v(" "),_("li",[_("p",[a._v("main函数之后")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("使用Instruments App Launch")])]),a._v(" "),_("li",[_("p",[a._v("使用打点计时")]),a._v(" "),_("ul",[_("li",[a._v("就是通过计算方法的调用时间差")]),a._v(" "),_("li",[a._v("缺点是无法判断具体是哪个方法超时，需要多次打点")])])]),a._v(" "),_("li",[_("p",[a._v("定时获取主线程的调用栈")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("缺点")]),a._v(" "),_("ul",[_("li",[a._v("1.拉取调用栈也会消耗时间，造成时间记录增加")])])])])]),a._v(" "),_("li",[_("p",[a._v("hook objc_msgSend")]),a._v(" "),_("ul",[_("li",[a._v("通过hook，我们可以在objc_msgSend前后插入监听方法，统计时间")])])])])])]),a._v(" "),_("h3",{attrs:{id:"ui"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ui"}},[a._v("#")]),a._v(" UI")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("FPS")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("通过CADisplayLink监测FPS")]),a._v(" "),_("ul",[_("li",[a._v("CADisplayLink是每刷新一帧时调用一次")])])])])]),a._v(" "),_("li",[_("p",[a._v("主线程卡顿监控")]),a._v(" "),_("ul",[_("li",[a._v("子线程监测主线程的runloop，判断两个状态之间的耗时是否达到一定阈值")]),a._v(" "),_("li",[a._v("子线程向主线程发送消息，如果如果消息一直未执行，那么就可以判断主线程在运行一个耗时的任务，此时子线程可以打印主线程的调用栈")])])]),a._v(" "),_("li",[_("p",[a._v("子线程操作UI")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("hook")]),a._v(" "),_("ul",[_("li",[a._v("setNeedsLayout")]),a._v(" "),_("li",[a._v("setNeedDisplay")]),a._v(" "),_("li",[a._v("setNeedsDisplayInRect")])])])])])]),a._v(" "),_("h3",{attrs:{id:"内存监控"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#内存监控"}},[a._v("#")]),a._v(" 内存监控")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("内存使用")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("FBAllocationTracker")]),a._v(" "),_("ul",[_("li",[a._v("hook [NSObject alloc]方法")]),a._v(" "),_("li",[a._v("只能捕获NSObject内存，无法捕获C++对象、malloc对象以及vm内存")])])]),a._v(" "),_("li",[_("p",[a._v("OOMDetector")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("hook内核层内存分配")]),a._v(" "),_("ul",[_("li",[a._v("malloc/calloc")]),a._v(" "),_("li",[a._v("捕获不到系统库的内存分配")])])]),a._v(" "),_("li",[_("p",[a._v("捕获内存分配多的堆栈")])])])])])]),a._v(" "),_("li",[_("p",[a._v("内存泄漏")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("MLeakFinder")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("hook很多方法")]),a._v(" "),_("ul",[_("li",[a._v("例如push/pop/dismiss")])])])])]),a._v(" "),_("li",[_("p",[a._v("FBRetainCycleDetector")]),a._v(" "),_("ul",[_("li",[a._v("获取所有对象的strong属性和block强引用，生成有向图")]),a._v(" "),_("li",[a._v("查找有向图的环")])])])])])]),a._v(" "),_("h3",{attrs:{id:"crash"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#crash"}},[a._v("#")]),a._v(" Crash")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("Mach异常")]),a._v(" "),_("ul",[_("li",[a._v("会转为UNIX异常")])])]),a._v(" "),_("li",[_("p",[a._v("UNIX异常")]),a._v(" "),_("ul",[_("li",[a._v("signal")]),a._v(" "),_("li",[a._v("swift异常")])])]),a._v(" "),_("li",[_("p",[a._v("Objective-C异常")]),a._v(" "),_("ul",[_("li",[a._v("NSUncaughtExceptionHandler")])])]),a._v(" "),_("li",[_("p",[a._v("watchDog")]),a._v(" "),_("ul",[_("li",[a._v("无法捕获")]),a._v(" "),_("li",[a._v("可以检测其他条件是否触发，比如crash/cpu过高/内存等来判定")])])]),a._v(" "),_("li",[_("p",[a._v("解析")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("dSYM")]),a._v(" "),_("ul",[_("li",[a._v("符号表")]),a._v(" "),_("li",[a._v("xcode解析")]),a._v(" "),_("li",[a._v("自动解析")])])])])])]),a._v(" "),_("h3",{attrs:{id:"连接超时"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#连接超时"}},[a._v("#")]),a._v(" 连接超时")]),a._v(" "),_("h3",{attrs:{id:"网络劫持"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#网络劫持"}},[a._v("#")]),a._v(" 网络劫持")]),a._v(" "),_("h3",{attrs:{id:"交互性能差"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#交互性能差"}},[a._v("#")]),a._v(" 交互性能差")]),a._v(" "),_("h3",{attrs:{id:"内存泄漏"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#内存泄漏"}},[a._v("#")]),a._v(" 内存泄漏")]),a._v(" "),_("h3",{attrs:{id:"不良接口"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#不良接口"}},[a._v("#")]),a._v(" 不良接口")]),a._v(" "),_("h2",{attrs:{id:"日志上报"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#日志上报"}},[a._v("#")]),a._v(" 日志上报")]),a._v(" "),_("h3",{attrs:{id:"收集"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#收集"}},[a._v("#")]),a._v(" 收集")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("无痕打点")]),a._v(" "),_("ul",[_("li",[a._v("hook")]),a._v(" "),_("li",[a._v("配置文件")])])]),a._v(" "),_("li",[_("p",[a._v("业务数据上报")])])]),a._v(" "),_("h3",{attrs:{id:"本地存储"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#本地存储"}},[a._v("#")]),a._v(" 本地存储")]),a._v(" "),_("h3",{attrs:{id:"批量上传"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#批量上传"}},[a._v("#")]),a._v(" 批量上传")]),a._v(" "),_("h2",{attrs:{id:"性能优化"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[a._v("#")]),a._v(" 性能优化")]),a._v(" "),_("h3",{attrs:{id:"启动优化"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#启动优化"}},[a._v("#")]),a._v(" 启动优化")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("main函数之前")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("dylib加载时间优化")]),a._v(" "),_("ul",[_("li",[a._v("减少不必要的framework")]),a._v(" "),_("li",[a._v("针对不同系统的支持，将framework设置为optional，例如iOS13中的combine")]),a._v(" "),_("li",[a._v("使用静态库")])])]),a._v(" "),_("li",[_("p",[a._v("rebase/binding time")]),a._v(" "),_("ul",[_("li",[a._v("合并或者删减一些无用的OC类")]),a._v(" "),_("li",[a._v("减少c++虚函数数量")]),a._v(" "),_("li",[a._v("使用swift struct")])])]),a._v(" "),_("li",[_("p",[a._v("Objc setup time")]),a._v(" "),_("ul",[_("li",[a._v("无优化项，是系统进行类的注册、将category插入原类")])])]),a._v(" "),_("li",[_("p",[a._v("initializer time")]),a._v(" "),_("ul",[_("li",[a._v("使用initialize替代load")]),a._v(" "),_("li",[a._v("不要在初始化中使用dlopen")])])])])]),a._v(" "),_("li",[_("p",[a._v("main函数之后")]),a._v(" "),_("ul",[_("li",[a._v("延迟/减少启动任务")]),a._v(" "),_("li",[a._v("先开启闪屏界面再处理数据")])])])]),a._v(" "),_("h3",{attrs:{id:"合理的线程分配"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#合理的线程分配"}},[a._v("#")]),a._v(" 合理的线程分配")]),a._v(" "),_("ul",[_("li",[a._v("大量的GCD使用会造成线程的分配数量不合理，所以对于一些操作我们固定线程，例如DB操作、日志记录、网络回调")])]),a._v(" "),_("h3",{attrs:{id:"预处理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#预处理"}},[a._v("#")]),a._v(" 预处理")]),a._v(" "),_("ul",[_("li",[a._v("对于初次显示需要耗费大量线程时间的操作，提前放到后台线程进行计算，比如读取本地缓存")])]),a._v(" "),_("h3",{attrs:{id:"延时加载"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#延时加载"}},[a._v("#")]),a._v(" 延时加载")]),a._v(" "),_("ul",[_("li",[a._v("对于某些操作，我们在需要使用时再去加载")])]),a._v(" "),_("h3",{attrs:{id:"缓存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[a._v("#")]),a._v(" 缓存")]),a._v(" "),_("h3",{attrs:{id:"正确的api"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#正确的api"}},[a._v("#")]),a._v(" 正确的api")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("例如")]),a._v(" "),_("ul",[_("li",[a._v("imageNamed:会缓存")]),a._v(" "),_("li",[a._v("imageWithContentsOfFile:不会缓存")]),a._v(" "),_("li",[a._v("缓存NSDateFormatter的结果")]),a._v(" "),_("li",[a._v("不要随意使用NSLog()")]),a._v(" "),_("li",[a._v("NSFileManager会浪费大量时间读取不需要的附加属性，推荐使用stat")])])])]),a._v(" "),_("h3",{attrs:{id:"crash-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#crash-2"}},[a._v("#")]),a._v(" crash")]),a._v(" "),_("ul",[_("li",[a._v("连续闪退时清空本地缓存数据")])]),a._v(" "),_("h3",{attrs:{id:"包体积"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#包体积"}},[a._v("#")]),a._v(" 包体积")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("资源")]),a._v(" "),_("ul",[_("li",[a._v("更小的图片格式")]),a._v(" "),_("li",[a._v("图片压缩")]),a._v(" "),_("li",[a._v("文件压缩")]),a._v(" "),_("li",[a._v("资源动态下载")]),a._v(" "),_("li",[a._v("清理无效资源")])])]),a._v(" "),_("li",[_("p",[a._v("App Thinning")]),a._v(" "),_("ul",[_("li",[a._v("开启bitcode")])])]),a._v(" "),_("li",[_("p",[a._v("清理无效代码")]),a._v(" "),_("ul",[_("li",[a._v("Clang")]),a._v(" "),_("li",[a._v("LinkMap")]),a._v(" "),_("li",[a._v("AppCode")])])])]),a._v(" "),_("h2",{attrs:{id:"影响因素"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#影响因素"}},[a._v("#")]),a._v(" 影响因素")]),a._v(" "),_("h3",{attrs:{id:"内存消耗"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#内存消耗"}},[a._v("#")]),a._v(" 内存消耗")]),a._v(" "),_("h3",{attrs:{id:"网络带宽效率"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#网络带宽效率"}},[a._v("#")]),a._v(" 网络带宽效率")]),a._v(" "),_("h3",{attrs:{id:"用户界面响应速度"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#用户界面响应速度"}},[a._v("#")]),a._v(" 用户界面响应速度")]),a._v(" "),_("h2",{attrs:{id:"性能指标"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#性能指标"}},[a._v("#")]),a._v(" 性能指标")]),a._v(" "),_("h3",{attrs:{id:"内存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#内存"}},[a._v("#")]),a._v(" 内存")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("栈")]),a._v(" "),_("ul",[_("li",[a._v("最大方法数")]),a._v(" "),_("li",[a._v("视图层级")])])]),a._v(" "),_("li",[_("p",[a._v("堆")])])]),a._v(" "),_("h3",{attrs:{id:"电量消耗"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#电量消耗"}},[a._v("#")]),a._v(" 电量消耗")]),a._v(" "),_("h3",{attrs:{id:"初始化时间"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#初始化时间"}},[a._v("#")]),a._v(" 初始化时间")]),a._v(" "),_("h3",{attrs:{id:"执行速度"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#执行速度"}},[a._v("#")]),a._v(" 执行速度")]),a._v(" "),_("h3",{attrs:{id:"响应速度"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#响应速度"}},[a._v("#")]),a._v(" 响应速度")]),a._v(" "),_("h3",{attrs:{id:"本地存储-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#本地存储-2"}},[a._v("#")]),a._v(" 本地存储")]),a._v(" "),_("h3",{attrs:{id:"互操作性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#互操作性"}},[a._v("#")]),a._v(" 互操作性")]),a._v(" "),_("ul",[_("li",[a._v("提供多个应用互操作的能力")])]),a._v(" "),_("h3",{attrs:{id:"网络环境"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#网络环境"}},[a._v("#")]),a._v(" 网络环境")]),a._v(" "),_("ul",[_("li",[a._v("高带宽稳定网络")]),a._v(" "),_("li",[a._v("低带宽稳定网络")]),a._v(" "),_("li",[a._v("高带宽不稳定网络")]),a._v(" "),_("li",[a._v("低带宽不稳定网络")]),a._v(" "),_("li",[a._v("无网络")])]),a._v(" "),_("h3",{attrs:{id:"带宽"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#带宽"}},[a._v("#")]),a._v(" 带宽")]),a._v(" "),_("h3",{attrs:{id:"数据刷新"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#数据刷新"}},[a._v("#")]),a._v(" 数据刷新")]),a._v(" "),_("ul",[_("li",[a._v("流量节省")])]),a._v(" "),_("h3",{attrs:{id:"多用户支持"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#多用户支持"}},[a._v("#")]),a._v(" 多用户支持")]),a._v(" "),_("h3",{attrs:{id:"单点登录"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#单点登录"}},[a._v("#")]),a._v(" 单点登录")]),a._v(" "),_("h3",{attrs:{id:"安全"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#安全"}},[a._v("#")]),a._v(" 安全")]),a._v(" "),_("h3",{attrs:{id:"崩溃"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#崩溃"}},[a._v("#")]),a._v(" 崩溃")]),a._v(" "),_("ul",[_("li",[a._v("僵尸对象")]),a._v(" "),_("li",[a._v("循环引用")])]),a._v(" "),_("h2",{attrs:{id:"cpu负责"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#cpu负责"}},[a._v("#")]),a._v(" cpu负责")]),a._v(" "),_("h3",{attrs:{id:"视图创建"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#视图创建"}},[a._v("#")]),a._v(" 视图创建")]),a._v(" "),_("h3",{attrs:{id:"布局计算"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#布局计算"}},[a._v("#")]),a._v(" 布局计算")]),a._v(" "),_("h3",{attrs:{id:"图片解码"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#图片解码"}},[a._v("#")]),a._v(" 图片解码")]),a._v(" "),_("h3",{attrs:{id:"文本绘制"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#文本绘制"}},[a._v("#")]),a._v(" 文本绘制")]),a._v(" "),_("h2",{attrs:{id:"性能分析方式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#性能分析方式"}},[a._v("#")]),a._v(" 性能分析方式")]),a._v(" "),_("h3",{attrs:{id:"采样"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#采样"}},[a._v("#")]),a._v(" 采样")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("以一定的周期间隔采集状态")])]),a._v(" "),_("li",[_("p",[a._v("优点")]),a._v(" "),_("ul",[_("li",[a._v("可用于跟踪CPU和内存的使用情况")])])]),a._v(" "),_("li",[_("p",[a._v("缺点")]),a._v(" "),_("ul",[_("li",[a._v("不够精细，因为间隔时间是固定的，间隔时间内的状态无法采集到")])])])]),a._v(" "),_("h3",{attrs:{id:"埋点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#埋点"}},[a._v("#")]),a._v(" 埋点")]),a._v(" "),_("ul",[_("li",[a._v("在关键部分主动埋点，有更加精确的结果")]),a._v(" "),_("li",[a._v("需要注入额外代码，一定会影响应用的性能")])]),a._v(" "),_("h2",{attrs:{id:"cpu"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#cpu"}},[a._v("#")]),a._v(" cpu")]),a._v(" "),_("h3",{attrs:{id:"uitableview"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#uitableview"}},[a._v("#")]),a._v(" UITableView")]),a._v(" "),_("ul",[_("li",[a._v("针对UITableView的高度判断处理数据的条数")]),a._v(" "),_("li",[a._v("当快速滚动时，速度降低到某一阈值后再处理数据，阈值根据单元格的复杂程度来决定")])]),a._v(" "),_("h2",{attrs:{id:"电量"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#电量"}},[a._v("#")]),a._v(" 电量")]),a._v(" "),_("h3",{attrs:{id:"网络"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#网络"}},[a._v("#")]),a._v(" 网络")]),a._v(" "),_("ul",[_("li",[a._v("监控网络状态，给予合适的网络资源")])]),a._v(" "),_("h3",{attrs:{id:"合适的定位精度"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#合适的定位精度"}},[a._v("#")]),a._v(" 合适的定位精度")]),a._v(" "),_("h3",{attrs:{id:"根据电量或者是否充电状态判断执行某些操作"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#根据电量或者是否充电状态判断执行某些操作"}},[a._v("#")]),a._v(" 根据电量或者是否充电状态判断执行某些操作")]),a._v(" "),_("h3",{attrs:{id:"如果电量低-在执行密集操作之前提示用户"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#如果电量低-在执行密集操作之前提示用户"}},[a._v("#")]),a._v(" 如果电量低，在执行密集操作之前提示用户")]),a._v(" "),_("p",[_("em",[a._v("XMind - Trial Version")])])])}),[],!1,null,null,null);v.default=s.exports}}]);